{"ast":null,"code":"/**\n * @author mrdoob / http://mrdoob.com/\n */\nimport { WebGLUniforms } from './WebGLUniforms.js';\nimport { WebGLShader } from './WebGLShader.js';\nimport { ShaderChunk } from '../shaders/ShaderChunk.js';\nimport { NoToneMapping, AddOperation, MixOperation, MultiplyOperation, EquirectangularRefractionMapping, CubeRefractionMapping, SphericalReflectionMapping, EquirectangularReflectionMapping, CubeUVRefractionMapping, CubeUVReflectionMapping, CubeReflectionMapping, PCFSoftShadowMap, PCFShadowMap, VSMShadowMap, ACESFilmicToneMapping, CineonToneMapping, Uncharted2ToneMapping, ReinhardToneMapping, LinearToneMapping, GammaEncoding, RGBDEncoding, RGBM16Encoding, RGBM7Encoding, RGBEEncoding, sRGBEncoding, LinearEncoding, LogLuvEncoding } from '../../constants.js';\nvar programIdCount = 0;\n\nfunction addLineNumbers(string) {\n  var lines = string.split('\\n');\n\n  for (var i = 0; i < lines.length; i++) {\n    lines[i] = i + 1 + ': ' + lines[i];\n  }\n\n  return lines.join('\\n');\n}\n\nfunction getEncodingComponents(encoding) {\n  switch (encoding) {\n    case LinearEncoding:\n      return ['Linear', '( value )'];\n\n    case sRGBEncoding:\n      return ['sRGB', '( value )'];\n\n    case RGBEEncoding:\n      return ['RGBE', '( value )'];\n\n    case RGBM7Encoding:\n      return ['RGBM', '( value, 7.0 )'];\n\n    case RGBM16Encoding:\n      return ['RGBM', '( value, 16.0 )'];\n\n    case RGBDEncoding:\n      return ['RGBD', '( value, 256.0 )'];\n\n    case GammaEncoding:\n      return ['Gamma', '( value, float( GAMMA_FACTOR ) )'];\n\n    case LogLuvEncoding:\n      return ['LogLuv', '( value )'];\n\n    default:\n      throw new Error('unsupported encoding: ' + encoding);\n  }\n}\n\nfunction getShaderErrors(gl, shader, type) {\n  var status = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  var log = gl.getShaderInfoLog(shader).trim();\n  if (status && log === '') return ''; // --enable-privileged-webgl-extension\n  // console.log( '**' + type + '**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\n\n  var source = gl.getShaderSource(shader);\n  return 'THREE.WebGLShader: gl.getShaderInfoLog() ' + type + '\\n' + log + addLineNumbers(source);\n}\n\nfunction getTexelDecodingFunction(functionName, encoding) {\n  var components = getEncodingComponents(encoding);\n  return 'vec4 ' + functionName + '( vec4 value ) { return ' + components[0] + 'ToLinear' + components[1] + '; }';\n}\n\nfunction getTexelEncodingFunction(functionName, encoding) {\n  var components = getEncodingComponents(encoding);\n  return 'vec4 ' + functionName + '( vec4 value ) { return LinearTo' + components[0] + components[1] + '; }';\n}\n\nfunction getToneMappingFunction(functionName, toneMapping) {\n  var toneMappingName;\n\n  switch (toneMapping) {\n    case LinearToneMapping:\n      toneMappingName = 'Linear';\n      break;\n\n    case ReinhardToneMapping:\n      toneMappingName = 'Reinhard';\n      break;\n\n    case Uncharted2ToneMapping:\n      toneMappingName = 'Uncharted2';\n      break;\n\n    case CineonToneMapping:\n      toneMappingName = 'OptimizedCineon';\n      break;\n\n    case ACESFilmicToneMapping:\n      toneMappingName = 'ACESFilmic';\n      break;\n\n    default:\n      throw new Error('unsupported toneMapping: ' + toneMapping);\n  }\n\n  return 'vec3 ' + functionName + '( vec3 color ) { return ' + toneMappingName + 'ToneMapping( color ); }';\n}\n\nfunction generateExtensions(parameters) {\n  var chunks = [parameters.extensionDerivatives || parameters.envMapCubeUV || parameters.bumpMap || parameters.tangentSpaceNormalMap || parameters.clearcoatNormalMap || parameters.flatShading || parameters.shaderID === 'physical' ? '#extension GL_OES_standard_derivatives : enable' : '', (parameters.extensionFragDepth || parameters.logarithmicDepthBuffer) && parameters.rendererExtensionFragDepth ? '#extension GL_EXT_frag_depth : enable' : '', parameters.extensionDrawBuffers && parameters.rendererExtensionDrawBuffers ? '#extension GL_EXT_draw_buffers : require' : '', (parameters.extensionShaderTextureLOD || parameters.envMap) && parameters.rendererExtensionShaderTextureLod ? '#extension GL_EXT_shader_texture_lod : enable' : ''];\n  return chunks.filter(filterEmptyLine).join('\\n');\n}\n\nfunction generateDefines(defines) {\n  var chunks = [];\n\n  for (var name in defines) {\n    var value = defines[name];\n    if (value === false) continue;\n    chunks.push('#define ' + name + ' ' + value);\n  }\n\n  return chunks.join('\\n');\n}\n\nfunction fetchAttributeLocations(gl, program) {\n  var attributes = {};\n  var n = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n\n  for (var i = 0; i < n; i++) {\n    var info = gl.getActiveAttrib(program, i);\n    var name = info.name; // console.log( 'THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:', name, i );\n\n    attributes[name] = gl.getAttribLocation(program, name);\n  }\n\n  return attributes;\n}\n\nfunction filterEmptyLine(string) {\n  return string !== '';\n}\n\nfunction replaceLightNums(string, parameters) {\n  return string.replace(/NUM_DIR_LIGHTS/g, parameters.numDirLights).replace(/NUM_SPOT_LIGHTS/g, parameters.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g, parameters.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g, parameters.numPointLights).replace(/NUM_HEMI_LIGHTS/g, parameters.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g, parameters.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g, parameters.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g, parameters.numPointLightShadows);\n}\n\nfunction replaceClippingPlaneNums(string, parameters) {\n  return string.replace(/NUM_CLIPPING_PLANES/g, parameters.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g, parameters.numClippingPlanes - parameters.numClipIntersection);\n} // Resolve Includes\n\n\nvar includePattern = /^[ \\t]*#include +<([\\w\\d./]+)>/gm;\n\nfunction resolveIncludes(string) {\n  return string.replace(includePattern, includeReplacer);\n}\n\nfunction includeReplacer(match, include) {\n  var string = ShaderChunk[include];\n\n  if (string === undefined) {\n    throw new Error('Can not resolve #include <' + include + '>');\n  }\n\n  return resolveIncludes(string);\n} // Unroll Loops\n\n\nvar deprecatedUnrollLoopPattern = /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g;\nvar unrollLoopPattern = /#pragma unroll_loop_start[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}[\\s]+?#pragma unroll_loop_end/g;\n\nfunction unrollLoops(string) {\n  return string.replace(unrollLoopPattern, loopReplacer).replace(deprecatedUnrollLoopPattern, deprecatedLoopReplacer);\n}\n\nfunction deprecatedLoopReplacer(match, start, end, snippet) {\n  console.warn('WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.');\n  return loopReplacer(match, start, end, snippet);\n}\n\nfunction loopReplacer(match, start, end, snippet) {\n  var string = '';\n\n  for (var i = parseInt(start); i < parseInt(end); i++) {\n    string += snippet.replace(/\\[ i \\]/g, '[ ' + i + ' ]').replace(/UNROLLED_LOOP_INDEX/g, i);\n  }\n\n  return string;\n} //\n\n\nfunction generatePrecision(parameters) {\n  var precisionstring = \"precision \" + parameters.precision + \" float;\\nprecision \" + parameters.precision + \" int;\";\n\n  if (parameters.precision === \"highp\") {\n    precisionstring += \"\\n#define HIGH_PRECISION\";\n  } else if (parameters.precision === \"mediump\") {\n    precisionstring += \"\\n#define MEDIUM_PRECISION\";\n  } else if (parameters.precision === \"lowp\") {\n    precisionstring += \"\\n#define LOW_PRECISION\";\n  }\n\n  return precisionstring;\n}\n\nfunction generateShadowMapTypeDefine(parameters) {\n  var shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\n\n  if (parameters.shadowMapType === PCFShadowMap) {\n    shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\n  } else if (parameters.shadowMapType === PCFSoftShadowMap) {\n    shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\n  } else if (parameters.shadowMapType === VSMShadowMap) {\n    shadowMapTypeDefine = 'SHADOWMAP_TYPE_VSM';\n  }\n\n  return shadowMapTypeDefine;\n}\n\nfunction generateEnvMapTypeDefine(parameters) {\n  var envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\n\n  if (parameters.envMap) {\n    switch (parameters.envMapMode) {\n      case CubeReflectionMapping:\n      case CubeRefractionMapping:\n        envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\n        break;\n\n      case CubeUVReflectionMapping:\n      case CubeUVRefractionMapping:\n        envMapTypeDefine = 'ENVMAP_TYPE_CUBE_UV';\n        break;\n\n      case EquirectangularReflectionMapping:\n      case EquirectangularRefractionMapping:\n        envMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\n        break;\n\n      case SphericalReflectionMapping:\n        envMapTypeDefine = 'ENVMAP_TYPE_SPHERE';\n        break;\n    }\n  }\n\n  return envMapTypeDefine;\n}\n\nfunction generateEnvMapModeDefine(parameters) {\n  var envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\n\n  if (parameters.envMap) {\n    switch (parameters.envMapMode) {\n      case CubeRefractionMapping:\n      case EquirectangularRefractionMapping:\n        envMapModeDefine = 'ENVMAP_MODE_REFRACTION';\n        break;\n    }\n  }\n\n  return envMapModeDefine;\n}\n\nfunction generateEnvMapBlendingDefine(parameters) {\n  var envMapBlendingDefine = 'ENVMAP_BLENDING_NONE';\n\n  if (parameters.envMap) {\n    switch (parameters.combine) {\n      case MultiplyOperation:\n        envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\n        break;\n\n      case MixOperation:\n        envMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\n        break;\n\n      case AddOperation:\n        envMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\n        break;\n    }\n  }\n\n  return envMapBlendingDefine;\n}\n\nfunction WebGLProgram(renderer, cacheKey, parameters) {\n  var gl = renderer.getContext();\n  var defines = parameters.defines;\n  var vertexShader = parameters.vertexShader;\n  var fragmentShader = parameters.fragmentShader;\n  var shadowMapTypeDefine = generateShadowMapTypeDefine(parameters);\n  var envMapTypeDefine = generateEnvMapTypeDefine(parameters);\n  var envMapModeDefine = generateEnvMapModeDefine(parameters);\n  var envMapBlendingDefine = generateEnvMapBlendingDefine(parameters);\n  var gammaFactorDefine = renderer.gammaFactor > 0 ? renderer.gammaFactor : 1.0;\n  var customExtensions = parameters.isWebGL2 ? '' : generateExtensions(parameters);\n  var customDefines = generateDefines(defines);\n  var program = gl.createProgram();\n  var prefixVertex, prefixFragment;\n\n  if (parameters.isRawShaderMaterial) {\n    prefixVertex = [customDefines].filter(filterEmptyLine).join('\\n');\n\n    if (prefixVertex.length > 0) {\n      prefixVertex += '\\n';\n    }\n\n    prefixFragment = [customExtensions, customDefines].filter(filterEmptyLine).join('\\n');\n\n    if (prefixFragment.length > 0) {\n      prefixFragment += '\\n';\n    }\n  } else {\n    prefixVertex = [generatePrecision(parameters), '#define SHADER_NAME ' + parameters.shaderName, customDefines, parameters.instancing ? '#define USE_INSTANCING' : '', parameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '', '#define GAMMA_FACTOR ' + gammaFactorDefine, '#define MAX_BONES ' + parameters.maxBones, parameters.useFog && parameters.fog ? '#define USE_FOG' : '', parameters.useFog && parameters.fogExp2 ? '#define FOG_EXP2' : '', parameters.map ? '#define USE_MAP' : '', parameters.envMap ? '#define USE_ENVMAP' : '', parameters.envMap ? '#define ' + envMapModeDefine : '', parameters.lightMap ? '#define USE_LIGHTMAP' : '', parameters.aoMap ? '#define USE_AOMAP' : '', parameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '', parameters.bumpMap ? '#define USE_BUMPMAP' : '', parameters.normalMap ? '#define USE_NORMALMAP' : '', parameters.normalMap && parameters.objectSpaceNormalMap ? '#define OBJECTSPACE_NORMALMAP' : '', parameters.normalMap && parameters.tangentSpaceNormalMap ? '#define TANGENTSPACE_NORMALMAP' : '', parameters.clearcoatMap ? '#define USE_CLEARCOATMAP' : '', parameters.clearcoatRoughnessMap ? '#define USE_CLEARCOAT_ROUGHNESSMAP' : '', parameters.clearcoatNormalMap ? '#define USE_CLEARCOAT_NORMALMAP' : '', parameters.displacementMap && parameters.supportsVertexTextures ? '#define USE_DISPLACEMENTMAP' : '', parameters.specularMap ? '#define USE_SPECULARMAP' : '', parameters.roughnessMap ? '#define USE_ROUGHNESSMAP' : '', parameters.metalnessMap ? '#define USE_METALNESSMAP' : '', parameters.alphaMap ? '#define USE_ALPHAMAP' : '', parameters.vertexTangents ? '#define USE_TANGENT' : '', parameters.vertexColors ? '#define USE_COLOR' : '', parameters.vertexUvs ? '#define USE_UV' : '', parameters.uvsVertexOnly ? '#define UVS_VERTEX_ONLY' : '', parameters.flatShading ? '#define FLAT_SHADED' : '', parameters.skinning ? '#define USE_SKINNING' : '', parameters.useVertexTexture ? '#define BONE_TEXTURE' : '', parameters.morphTargets ? '#define USE_MORPHTARGETS' : '', parameters.morphNormals && parameters.flatShading === false ? '#define USE_MORPHNORMALS' : '', parameters.doubleSided ? '#define DOUBLE_SIDED' : '', parameters.flipSided ? '#define FLIP_SIDED' : '', parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '', parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '', parameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '', parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '', parameters.logarithmicDepthBuffer && parameters.rendererExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '', 'uniform mat4 modelMatrix;', 'uniform mat4 modelViewMatrix;', 'uniform mat4 projectionMatrix;', 'uniform mat4 viewMatrix;', 'uniform mat3 normalMatrix;', 'uniform vec3 cameraPosition;', 'uniform bool isOrthographic;', '#ifdef USE_INSTANCING', ' attribute mat4 instanceMatrix;', '#endif', 'attribute vec3 position;', 'attribute vec3 normal;', 'attribute vec2 uv;', '#ifdef USE_TANGENT', '\tattribute vec4 tangent;', '#endif', '#ifdef USE_COLOR', '\tattribute vec3 color;', '#endif', '#ifdef USE_MORPHTARGETS', '\tattribute vec3 morphTarget0;', '\tattribute vec3 morphTarget1;', '\tattribute vec3 morphTarget2;', '\tattribute vec3 morphTarget3;', '\t#ifdef USE_MORPHNORMALS', '\t\tattribute vec3 morphNormal0;', '\t\tattribute vec3 morphNormal1;', '\t\tattribute vec3 morphNormal2;', '\t\tattribute vec3 morphNormal3;', '\t#else', '\t\tattribute vec3 morphTarget4;', '\t\tattribute vec3 morphTarget5;', '\t\tattribute vec3 morphTarget6;', '\t\tattribute vec3 morphTarget7;', '\t#endif', '#endif', '#ifdef USE_SKINNING', '\tattribute vec4 skinIndex;', '\tattribute vec4 skinWeight;', '#endif', '\\n'].filter(filterEmptyLine).join('\\n');\n    prefixFragment = [customExtensions, generatePrecision(parameters), '#define SHADER_NAME ' + parameters.shaderName, customDefines, parameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest + (parameters.alphaTest % 1 ? '' : '.0') : '', // add '.0' if integer\n    '#define GAMMA_FACTOR ' + gammaFactorDefine, parameters.useFog && parameters.fog ? '#define USE_FOG' : '', parameters.useFog && parameters.fogExp2 ? '#define FOG_EXP2' : '', parameters.map ? '#define USE_MAP' : '', parameters.matcap ? '#define USE_MATCAP' : '', parameters.envMap ? '#define USE_ENVMAP' : '', parameters.envMap ? '#define ' + envMapTypeDefine : '', parameters.envMap ? '#define ' + envMapModeDefine : '', parameters.envMap ? '#define ' + envMapBlendingDefine : '', parameters.lightMap ? '#define USE_LIGHTMAP' : '', parameters.aoMap ? '#define USE_AOMAP' : '', parameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '', parameters.bumpMap ? '#define USE_BUMPMAP' : '', parameters.normalMap ? '#define USE_NORMALMAP' : '', parameters.normalMap && parameters.objectSpaceNormalMap ? '#define OBJECTSPACE_NORMALMAP' : '', parameters.normalMap && parameters.tangentSpaceNormalMap ? '#define TANGENTSPACE_NORMALMAP' : '', parameters.clearcoatMap ? '#define USE_CLEARCOATMAP' : '', parameters.clearcoatRoughnessMap ? '#define USE_CLEARCOAT_ROUGHNESSMAP' : '', parameters.clearcoatNormalMap ? '#define USE_CLEARCOAT_NORMALMAP' : '', parameters.specularMap ? '#define USE_SPECULARMAP' : '', parameters.roughnessMap ? '#define USE_ROUGHNESSMAP' : '', parameters.metalnessMap ? '#define USE_METALNESSMAP' : '', parameters.alphaMap ? '#define USE_ALPHAMAP' : '', parameters.sheen ? '#define USE_SHEEN' : '', parameters.vertexTangents ? '#define USE_TANGENT' : '', parameters.vertexColors ? '#define USE_COLOR' : '', parameters.vertexUvs ? '#define USE_UV' : '', parameters.uvsVertexOnly ? '#define UVS_VERTEX_ONLY' : '', parameters.gradientMap ? '#define USE_GRADIENTMAP' : '', parameters.flatShading ? '#define FLAT_SHADED' : '', parameters.doubleSided ? '#define DOUBLE_SIDED' : '', parameters.flipSided ? '#define FLIP_SIDED' : '', parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '', parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '', parameters.premultipliedAlpha ? '#define PREMULTIPLIED_ALPHA' : '', parameters.physicallyCorrectLights ? '#define PHYSICALLY_CORRECT_LIGHTS' : '', parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '', parameters.logarithmicDepthBuffer && parameters.rendererExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '', (parameters.extensionShaderTextureLOD || parameters.envMap) && parameters.rendererExtensionShaderTextureLod ? '#define TEXTURE_LOD_EXT' : '', 'uniform mat4 viewMatrix;', 'uniform vec3 cameraPosition;', 'uniform bool isOrthographic;', parameters.toneMapping !== NoToneMapping ? '#define TONE_MAPPING' : '', parameters.toneMapping !== NoToneMapping ? ShaderChunk['tonemapping_pars_fragment'] : '', // this code is required here because it is used by the toneMapping() function defined below\n    parameters.toneMapping !== NoToneMapping ? getToneMappingFunction('toneMapping', parameters.toneMapping) : '', parameters.dithering ? '#define DITHERING' : '', parameters.outputEncoding || parameters.mapEncoding || parameters.matcapEncoding || parameters.envMapEncoding || parameters.emissiveMapEncoding || parameters.lightMapEncoding ? ShaderChunk['encodings_pars_fragment'] : '', // this code is required here because it is used by the various encoding/decoding function defined below\n    parameters.mapEncoding ? getTexelDecodingFunction('mapTexelToLinear', parameters.mapEncoding) : '', parameters.matcapEncoding ? getTexelDecodingFunction('matcapTexelToLinear', parameters.matcapEncoding) : '', parameters.envMapEncoding ? getTexelDecodingFunction('envMapTexelToLinear', parameters.envMapEncoding) : '', parameters.emissiveMapEncoding ? getTexelDecodingFunction('emissiveMapTexelToLinear', parameters.emissiveMapEncoding) : '', parameters.lightMapEncoding ? getTexelDecodingFunction('lightMapTexelToLinear', parameters.lightMapEncoding) : '', parameters.outputEncoding ? getTexelEncodingFunction('linearToOutputTexel', parameters.outputEncoding) : '', parameters.depthPacking ? '#define DEPTH_PACKING ' + parameters.depthPacking : '', '\\n'].filter(filterEmptyLine).join('\\n');\n  }\n\n  vertexShader = resolveIncludes(vertexShader);\n  vertexShader = replaceLightNums(vertexShader, parameters);\n  vertexShader = replaceClippingPlaneNums(vertexShader, parameters);\n  fragmentShader = resolveIncludes(fragmentShader);\n  fragmentShader = replaceLightNums(fragmentShader, parameters);\n  fragmentShader = replaceClippingPlaneNums(fragmentShader, parameters);\n  vertexShader = unrollLoops(vertexShader);\n  fragmentShader = unrollLoops(fragmentShader);\n\n  if (parameters.isWebGL2 && !parameters.isRawShaderMaterial) {\n    var isGLSL3ShaderMaterial = false;\n    var versionRegex = /^\\s*#version\\s+300\\s+es\\s*\\n/;\n\n    if (parameters.isShaderMaterial && vertexShader.match(versionRegex) !== null && fragmentShader.match(versionRegex) !== null) {\n      isGLSL3ShaderMaterial = true;\n      vertexShader = vertexShader.replace(versionRegex, '');\n      fragmentShader = fragmentShader.replace(versionRegex, '');\n    } // GLSL 3.0 conversion\n\n\n    prefixVertex = ['#version 300 es\\n', '#define attribute in', '#define varying out', '#define texture2D texture'].join('\\n') + '\\n' + prefixVertex;\n    prefixFragment = ['#version 300 es\\n', '#define varying in', isGLSL3ShaderMaterial ? '' : 'out highp vec4 pc_fragColor;', isGLSL3ShaderMaterial ? '' : '#define gl_FragColor pc_fragColor', '#define gl_FragDepthEXT gl_FragDepth', '#define texture2D texture', '#define textureCube texture', '#define texture2DProj textureProj', '#define texture2DLodEXT textureLod', '#define texture2DProjLodEXT textureProjLod', '#define textureCubeLodEXT textureLod', '#define texture2DGradEXT textureGrad', '#define texture2DProjGradEXT textureProjGrad', '#define textureCubeGradEXT textureGrad'].join('\\n') + '\\n' + prefixFragment;\n  }\n\n  var vertexGlsl = prefixVertex + vertexShader;\n  var fragmentGlsl = prefixFragment + fragmentShader; // console.log( '*VERTEX*', vertexGlsl );\n  // console.log( '*FRAGMENT*', fragmentGlsl );\n\n  var glVertexShader = WebGLShader(gl, gl.VERTEX_SHADER, vertexGlsl);\n  var glFragmentShader = WebGLShader(gl, gl.FRAGMENT_SHADER, fragmentGlsl);\n  gl.attachShader(program, glVertexShader);\n  gl.attachShader(program, glFragmentShader); // Force a particular attribute to index 0.\n\n  if (parameters.index0AttributeName !== undefined) {\n    gl.bindAttribLocation(program, 0, parameters.index0AttributeName);\n  } else if (parameters.morphTargets === true) {\n    // programs with morphTargets displace position out of attribute 0\n    gl.bindAttribLocation(program, 0, 'position');\n  }\n\n  gl.linkProgram(program); // check for link errors\n\n  if (renderer.debug.checkShaderErrors) {\n    var programLog = gl.getProgramInfoLog(program).trim();\n    var vertexLog = gl.getShaderInfoLog(glVertexShader).trim();\n    var fragmentLog = gl.getShaderInfoLog(glFragmentShader).trim();\n    var runnable = true;\n    var haveDiagnostics = true;\n\n    if (gl.getProgramParameter(program, gl.LINK_STATUS) === false) {\n      runnable = false;\n      var vertexErrors = getShaderErrors(gl, glVertexShader, 'vertex');\n      var fragmentErrors = getShaderErrors(gl, glFragmentShader, 'fragment');\n      console.error('THREE.WebGLProgram: shader error: ', gl.getError(), 'gl.VALIDATE_STATUS', gl.getProgramParameter(program, gl.VALIDATE_STATUS), 'gl.getProgramInfoLog', programLog, vertexErrors, fragmentErrors);\n    } else if (programLog !== '') {\n      console.warn('THREE.WebGLProgram: gl.getProgramInfoLog()', programLog);\n    } else if (vertexLog === '' || fragmentLog === '') {\n      haveDiagnostics = false;\n    }\n\n    if (haveDiagnostics) {\n      this.diagnostics = {\n        runnable: runnable,\n        programLog: programLog,\n        vertexShader: {\n          log: vertexLog,\n          prefix: prefixVertex\n        },\n        fragmentShader: {\n          log: fragmentLog,\n          prefix: prefixFragment\n        }\n      };\n    }\n  } // clean up\n\n\n  gl.detachShader(program, glVertexShader);\n  gl.detachShader(program, glFragmentShader);\n  gl.deleteShader(glVertexShader);\n  gl.deleteShader(glFragmentShader); // set up caching for uniform locations\n\n  var cachedUniforms;\n\n  this.getUniforms = function () {\n    if (cachedUniforms === undefined) {\n      cachedUniforms = new WebGLUniforms(gl, program);\n    }\n\n    return cachedUniforms;\n  }; // set up caching for attribute locations\n\n\n  var cachedAttributes;\n\n  this.getAttributes = function () {\n    if (cachedAttributes === undefined) {\n      cachedAttributes = fetchAttributeLocations(gl, program);\n    }\n\n    return cachedAttributes;\n  }; // free resource\n\n\n  this.destroy = function () {\n    gl.deleteProgram(program);\n    this.program = undefined;\n  }; //\n\n\n  this.name = parameters.shaderName;\n  this.id = programIdCount++;\n  this.cacheKey = cacheKey;\n  this.usedTimes = 1;\n  this.program = program;\n  this.vertexShader = glVertexShader;\n  this.fragmentShader = glFragmentShader;\n  return this;\n}\n\nexport { WebGLProgram };","map":{"version":3,"sources":["D:/chrlab/src/component/panelComponent/Canvas/threejs/src/renderers/webgl/WebGLProgram.js"],"names":["WebGLUniforms","WebGLShader","ShaderChunk","NoToneMapping","AddOperation","MixOperation","MultiplyOperation","EquirectangularRefractionMapping","CubeRefractionMapping","SphericalReflectionMapping","EquirectangularReflectionMapping","CubeUVRefractionMapping","CubeUVReflectionMapping","CubeReflectionMapping","PCFSoftShadowMap","PCFShadowMap","VSMShadowMap","ACESFilmicToneMapping","CineonToneMapping","Uncharted2ToneMapping","ReinhardToneMapping","LinearToneMapping","GammaEncoding","RGBDEncoding","RGBM16Encoding","RGBM7Encoding","RGBEEncoding","sRGBEncoding","LinearEncoding","LogLuvEncoding","programIdCount","addLineNumbers","string","lines","split","i","length","join","getEncodingComponents","encoding","Error","getShaderErrors","gl","shader","type","status","getShaderParameter","COMPILE_STATUS","log","getShaderInfoLog","trim","source","getShaderSource","getTexelDecodingFunction","functionName","components","getTexelEncodingFunction","getToneMappingFunction","toneMapping","toneMappingName","generateExtensions","parameters","chunks","extensionDerivatives","envMapCubeUV","bumpMap","tangentSpaceNormalMap","clearcoatNormalMap","flatShading","shaderID","extensionFragDepth","logarithmicDepthBuffer","rendererExtensionFragDepth","extensionDrawBuffers","rendererExtensionDrawBuffers","extensionShaderTextureLOD","envMap","rendererExtensionShaderTextureLod","filter","filterEmptyLine","generateDefines","defines","name","value","push","fetchAttributeLocations","program","attributes","n","getProgramParameter","ACTIVE_ATTRIBUTES","info","getActiveAttrib","getAttribLocation","replaceLightNums","replace","numDirLights","numSpotLights","numRectAreaLights","numPointLights","numHemiLights","numDirLightShadows","numSpotLightShadows","numPointLightShadows","replaceClippingPlaneNums","numClippingPlanes","numClipIntersection","includePattern","resolveIncludes","includeReplacer","match","include","undefined","deprecatedUnrollLoopPattern","unrollLoopPattern","unrollLoops","loopReplacer","deprecatedLoopReplacer","start","end","snippet","console","warn","parseInt","generatePrecision","precisionstring","precision","generateShadowMapTypeDefine","shadowMapTypeDefine","shadowMapType","generateEnvMapTypeDefine","envMapTypeDefine","envMapMode","generateEnvMapModeDefine","envMapModeDefine","generateEnvMapBlendingDefine","envMapBlendingDefine","combine","WebGLProgram","renderer","cacheKey","getContext","vertexShader","fragmentShader","gammaFactorDefine","gammaFactor","customExtensions","isWebGL2","customDefines","createProgram","prefixVertex","prefixFragment","isRawShaderMaterial","shaderName","instancing","supportsVertexTextures","maxBones","useFog","fog","fogExp2","map","lightMap","aoMap","emissiveMap","normalMap","objectSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","displacementMap","specularMap","roughnessMap","metalnessMap","alphaMap","vertexTangents","vertexColors","vertexUvs","uvsVertexOnly","skinning","useVertexTexture","morphTargets","morphNormals","doubleSided","flipSided","shadowMapEnabled","sizeAttenuation","alphaTest","matcap","sheen","gradientMap","premultipliedAlpha","physicallyCorrectLights","dithering","outputEncoding","mapEncoding","matcapEncoding","envMapEncoding","emissiveMapEncoding","lightMapEncoding","depthPacking","isGLSL3ShaderMaterial","versionRegex","isShaderMaterial","vertexGlsl","fragmentGlsl","glVertexShader","VERTEX_SHADER","glFragmentShader","FRAGMENT_SHADER","attachShader","index0AttributeName","bindAttribLocation","linkProgram","debug","checkShaderErrors","programLog","getProgramInfoLog","vertexLog","fragmentLog","runnable","haveDiagnostics","LINK_STATUS","vertexErrors","fragmentErrors","error","getError","VALIDATE_STATUS","diagnostics","prefix","detachShader","deleteShader","cachedUniforms","getUniforms","cachedAttributes","getAttributes","destroy","deleteProgram","id","usedTimes"],"mappings":"AAAA;;;AAIA,SAASA,aAAT,QAA8B,oBAA9B;AACA,SAASC,WAAT,QAA4B,kBAA5B;AACA,SAASC,WAAT,QAA4B,2BAA5B;AACA,SAASC,aAAT,EAAwBC,YAAxB,EAAsCC,YAAtC,EAAoDC,iBAApD,EAAuEC,gCAAvE,EAAyGC,qBAAzG,EAAgIC,0BAAhI,EAA4JC,gCAA5J,EAA8LC,uBAA9L,EAAuNC,uBAAvN,EAAgPC,qBAAhP,EAAuQC,gBAAvQ,EAAyRC,YAAzR,EAAuSC,YAAvS,EAAqTC,qBAArT,EAA4UC,iBAA5U,EAA+VC,qBAA/V,EAAsXC,mBAAtX,EAA2YC,iBAA3Y,EAA8ZC,aAA9Z,EAA6aC,YAA7a,EAA2bC,cAA3b,EAA2cC,aAA3c,EAA0dC,YAA1d,EAAweC,YAAxe,EAAsfC,cAAtf,EAAsgBC,cAAtgB,QAA4hB,oBAA5hB;AAEA,IAAIC,cAAc,GAAG,CAArB;;AAEA,SAASC,cAAT,CAAyBC,MAAzB,EAAkC;AAEjC,MAAIC,KAAK,GAAGD,MAAM,CAACE,KAAP,CAAc,IAAd,CAAZ;;AAEA,OAAM,IAAIC,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGF,KAAK,CAACG,MAA3B,EAAmCD,CAAC,EAApC,EAA0C;AAEzCF,IAAAA,KAAK,CAAEE,CAAF,CAAL,GAAeA,CAAC,GAAG,CAAN,GAAY,IAAZ,GAAmBF,KAAK,CAAEE,CAAF,CAArC;AAEA;;AAED,SAAOF,KAAK,CAACI,IAAN,CAAY,IAAZ,CAAP;AAEA;;AAED,SAASC,qBAAT,CAAgCC,QAAhC,EAA2C;AAE1C,UAASA,QAAT;AAEC,SAAKX,cAAL;AACC,aAAO,CAAE,QAAF,EAAY,WAAZ,CAAP;;AACD,SAAKD,YAAL;AACC,aAAO,CAAE,MAAF,EAAU,WAAV,CAAP;;AACD,SAAKD,YAAL;AACC,aAAO,CAAE,MAAF,EAAU,WAAV,CAAP;;AACD,SAAKD,aAAL;AACC,aAAO,CAAE,MAAF,EAAU,gBAAV,CAAP;;AACD,SAAKD,cAAL;AACC,aAAO,CAAE,MAAF,EAAU,iBAAV,CAAP;;AACD,SAAKD,YAAL;AACC,aAAO,CAAE,MAAF,EAAU,kBAAV,CAAP;;AACD,SAAKD,aAAL;AACC,aAAO,CAAE,OAAF,EAAW,kCAAX,CAAP;;AACD,SAAKO,cAAL;AACC,aAAO,CAAE,QAAF,EAAY,WAAZ,CAAP;;AACD;AACC,YAAM,IAAIW,KAAJ,CAAW,2BAA2BD,QAAtC,CAAN;AAnBF;AAuBA;;AAED,SAASE,eAAT,CAA0BC,EAA1B,EAA8BC,MAA9B,EAAsCC,IAAtC,EAA6C;AAE5C,MAAIC,MAAM,GAAGH,EAAE,CAACI,kBAAH,CAAuBH,MAAvB,EAA+BD,EAAE,CAACK,cAAlC,CAAb;AACA,MAAIC,GAAG,GAAGN,EAAE,CAACO,gBAAH,CAAqBN,MAArB,EAA8BO,IAA9B,EAAV;AAEA,MAAKL,MAAM,IAAIG,GAAG,KAAK,EAAvB,EAA4B,OAAO,EAAP,CALgB,CAO5C;AACA;;AAEA,MAAIG,MAAM,GAAGT,EAAE,CAACU,eAAH,CAAoBT,MAApB,CAAb;AAEA,SAAO,8CAA8CC,IAA9C,GAAqD,IAArD,GAA4DI,GAA5D,GAAkEjB,cAAc,CAAEoB,MAAF,CAAvF;AAEA;;AAED,SAASE,wBAAT,CAAmCC,YAAnC,EAAiDf,QAAjD,EAA4D;AAE3D,MAAIgB,UAAU,GAAGjB,qBAAqB,CAAEC,QAAF,CAAtC;AACA,SAAO,UAAUe,YAAV,GAAyB,0BAAzB,GAAsDC,UAAU,CAAE,CAAF,CAAhE,GAAwE,UAAxE,GAAqFA,UAAU,CAAE,CAAF,CAA/F,GAAuG,KAA9G;AAEA;;AAED,SAASC,wBAAT,CAAmCF,YAAnC,EAAiDf,QAAjD,EAA4D;AAE3D,MAAIgB,UAAU,GAAGjB,qBAAqB,CAAEC,QAAF,CAAtC;AACA,SAAO,UAAUe,YAAV,GAAyB,kCAAzB,GAA8DC,UAAU,CAAE,CAAF,CAAxE,GAAgFA,UAAU,CAAE,CAAF,CAA1F,GAAkG,KAAzG;AAEA;;AAED,SAASE,sBAAT,CAAiCH,YAAjC,EAA+CI,WAA/C,EAA6D;AAE5D,MAAIC,eAAJ;;AAEA,UAASD,WAAT;AAEC,SAAKrC,iBAAL;AACCsC,MAAAA,eAAe,GAAG,QAAlB;AACA;;AAED,SAAKvC,mBAAL;AACCuC,MAAAA,eAAe,GAAG,UAAlB;AACA;;AAED,SAAKxC,qBAAL;AACCwC,MAAAA,eAAe,GAAG,YAAlB;AACA;;AAED,SAAKzC,iBAAL;AACCyC,MAAAA,eAAe,GAAG,iBAAlB;AACA;;AAED,SAAK1C,qBAAL;AACC0C,MAAAA,eAAe,GAAG,YAAlB;AACA;;AAED;AACC,YAAM,IAAInB,KAAJ,CAAW,8BAA8BkB,WAAzC,CAAN;AAvBF;;AA2BA,SAAO,UAAUJ,YAAV,GAAyB,0BAAzB,GAAsDK,eAAtD,GAAwE,yBAA/E;AAEA;;AAED,SAASC,kBAAT,CAA6BC,UAA7B,EAA0C;AAEzC,MAAIC,MAAM,GAAG,CACVD,UAAU,CAACE,oBAAX,IAAmCF,UAAU,CAACG,YAA9C,IAA8DH,UAAU,CAACI,OAAzE,IAAoFJ,UAAU,CAACK,qBAA/F,IAAwHL,UAAU,CAACM,kBAAnI,IAAyJN,UAAU,CAACO,WAApK,IAAmLP,UAAU,CAACQ,QAAX,KAAwB,UAA7M,GAA4N,iDAA5N,GAAgR,EADpQ,EAEZ,CAAER,UAAU,CAACS,kBAAX,IAAiCT,UAAU,CAACU,sBAA9C,KAA0EV,UAAU,CAACW,0BAArF,GAAkH,uCAAlH,GAA4J,EAFhJ,EAGVX,UAAU,CAACY,oBAAX,IAAmCZ,UAAU,CAACa,4BAAhD,GAAiF,0CAAjF,GAA8H,EAHlH,EAIZ,CAAEb,UAAU,CAACc,yBAAX,IAAwCd,UAAU,CAACe,MAArD,KAAiEf,UAAU,CAACgB,iCAA5E,GAAgH,+CAAhH,GAAkK,EAJtJ,CAAb;AAOA,SAAOf,MAAM,CAACgB,MAAP,CAAeC,eAAf,EAAiC1C,IAAjC,CAAuC,IAAvC,CAAP;AAEA;;AAED,SAAS2C,eAAT,CAA0BC,OAA1B,EAAoC;AAEnC,MAAInB,MAAM,GAAG,EAAb;;AAEA,OAAM,IAAIoB,IAAV,IAAkBD,OAAlB,EAA4B;AAE3B,QAAIE,KAAK,GAAGF,OAAO,CAAEC,IAAF,CAAnB;AAEA,QAAKC,KAAK,KAAK,KAAf,EAAuB;AAEvBrB,IAAAA,MAAM,CAACsB,IAAP,CAAa,aAAaF,IAAb,GAAoB,GAApB,GAA0BC,KAAvC;AAEA;;AAED,SAAOrB,MAAM,CAACzB,IAAP,CAAa,IAAb,CAAP;AAEA;;AAED,SAASgD,uBAAT,CAAkC3C,EAAlC,EAAsC4C,OAAtC,EAAgD;AAE/C,MAAIC,UAAU,GAAG,EAAjB;AAEA,MAAIC,CAAC,GAAG9C,EAAE,CAAC+C,mBAAH,CAAwBH,OAAxB,EAAiC5C,EAAE,CAACgD,iBAApC,CAAR;;AAEA,OAAM,IAAIvD,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGqD,CAArB,EAAwBrD,CAAC,EAAzB,EAA+B;AAE9B,QAAIwD,IAAI,GAAGjD,EAAE,CAACkD,eAAH,CAAoBN,OAApB,EAA6BnD,CAA7B,CAAX;AACA,QAAI+C,IAAI,GAAGS,IAAI,CAACT,IAAhB,CAH8B,CAK9B;;AAEAK,IAAAA,UAAU,CAAEL,IAAF,CAAV,GAAqBxC,EAAE,CAACmD,iBAAH,CAAsBP,OAAtB,EAA+BJ,IAA/B,CAArB;AAEA;;AAED,SAAOK,UAAP;AAEA;;AAED,SAASR,eAAT,CAA0B/C,MAA1B,EAAmC;AAElC,SAAOA,MAAM,KAAK,EAAlB;AAEA;;AAED,SAAS8D,gBAAT,CAA2B9D,MAA3B,EAAmC6B,UAAnC,EAAgD;AAE/C,SAAO7B,MAAM,CACX+D,OADK,CACI,iBADJ,EACuBlC,UAAU,CAACmC,YADlC,EAELD,OAFK,CAEI,kBAFJ,EAEwBlC,UAAU,CAACoC,aAFnC,EAGLF,OAHK,CAGI,uBAHJ,EAG6BlC,UAAU,CAACqC,iBAHxC,EAILH,OAJK,CAII,mBAJJ,EAIyBlC,UAAU,CAACsC,cAJpC,EAKLJ,OALK,CAKI,kBALJ,EAKwBlC,UAAU,CAACuC,aALnC,EAMLL,OANK,CAMI,wBANJ,EAM8BlC,UAAU,CAACwC,kBANzC,EAOLN,OAPK,CAOI,yBAPJ,EAO+BlC,UAAU,CAACyC,mBAP1C,EAQLP,OARK,CAQI,0BARJ,EAQgClC,UAAU,CAAC0C,oBAR3C,CAAP;AAUA;;AAED,SAASC,wBAAT,CAAmCxE,MAAnC,EAA2C6B,UAA3C,EAAwD;AAEvD,SAAO7B,MAAM,CACX+D,OADK,CACI,sBADJ,EAC4BlC,UAAU,CAAC4C,iBADvC,EAELV,OAFK,CAEI,wBAFJ,EAEgClC,UAAU,CAAC4C,iBAAX,GAA+B5C,UAAU,CAAC6C,mBAF1E,CAAP;AAIA,C,CAED;;;AAEA,IAAIC,cAAc,GAAG,kCAArB;;AAEA,SAASC,eAAT,CAA0B5E,MAA1B,EAAmC;AAElC,SAAOA,MAAM,CAAC+D,OAAP,CAAgBY,cAAhB,EAAgCE,eAAhC,CAAP;AAEA;;AAED,SAASA,eAAT,CAA0BC,KAA1B,EAAiCC,OAAjC,EAA2C;AAE1C,MAAI/E,MAAM,GAAG9B,WAAW,CAAE6G,OAAF,CAAxB;;AAEA,MAAK/E,MAAM,KAAKgF,SAAhB,EAA4B;AAE3B,UAAM,IAAIxE,KAAJ,CAAW,+BAA+BuE,OAA/B,GAAyC,GAApD,CAAN;AAEA;;AAED,SAAOH,eAAe,CAAE5E,MAAF,CAAtB;AAEA,C,CAED;;;AAEA,IAAIiF,2BAA2B,GAAG,8FAAlC;AACA,IAAIC,iBAAiB,GAAG,iIAAxB;;AAEA,SAASC,WAAT,CAAsBnF,MAAtB,EAA+B;AAE9B,SAAOA,MAAM,CACX+D,OADK,CACImB,iBADJ,EACuBE,YADvB,EAELrB,OAFK,CAEIkB,2BAFJ,EAEiCI,sBAFjC,CAAP;AAIA;;AAED,SAASA,sBAAT,CAAiCP,KAAjC,EAAwCQ,KAAxC,EAA+CC,GAA/C,EAAoDC,OAApD,EAA8D;AAE7DC,EAAAA,OAAO,CAACC,IAAR,CAAc,qHAAd;AACA,SAAON,YAAY,CAAEN,KAAF,EAASQ,KAAT,EAAgBC,GAAhB,EAAqBC,OAArB,CAAnB;AAEA;;AAED,SAASJ,YAAT,CAAuBN,KAAvB,EAA8BQ,KAA9B,EAAqCC,GAArC,EAA0CC,OAA1C,EAAoD;AAEnD,MAAIxF,MAAM,GAAG,EAAb;;AAEA,OAAM,IAAIG,CAAC,GAAGwF,QAAQ,CAAEL,KAAF,CAAtB,EAAiCnF,CAAC,GAAGwF,QAAQ,CAAEJ,GAAF,CAA7C,EAAsDpF,CAAC,EAAvD,EAA6D;AAE5DH,IAAAA,MAAM,IAAIwF,OAAO,CACfzB,OADQ,CACC,UADD,EACa,OAAO5D,CAAP,GAAW,IADxB,EAER4D,OAFQ,CAEC,sBAFD,EAEyB5D,CAFzB,CAAV;AAIA;;AAED,SAAOH,MAAP;AAEA,C,CAED;;;AAEA,SAAS4F,iBAAT,CAA4B/D,UAA5B,EAAyC;AAExC,MAAIgE,eAAe,GAAG,eAAehE,UAAU,CAACiE,SAA1B,GAAsC,qBAAtC,GAA8DjE,UAAU,CAACiE,SAAzE,GAAqF,OAA3G;;AAEA,MAAKjE,UAAU,CAACiE,SAAX,KAAyB,OAA9B,EAAwC;AAEvCD,IAAAA,eAAe,IAAI,0BAAnB;AAEA,GAJD,MAIO,IAAKhE,UAAU,CAACiE,SAAX,KAAyB,SAA9B,EAA0C;AAEhDD,IAAAA,eAAe,IAAI,4BAAnB;AAEA,GAJM,MAIA,IAAKhE,UAAU,CAACiE,SAAX,KAAyB,MAA9B,EAAuC;AAE7CD,IAAAA,eAAe,IAAI,yBAAnB;AAEA;;AAED,SAAOA,eAAP;AAEA;;AAED,SAASE,2BAAT,CAAsClE,UAAtC,EAAmD;AAElD,MAAImE,mBAAmB,GAAG,sBAA1B;;AAEA,MAAKnE,UAAU,CAACoE,aAAX,KAA6BlH,YAAlC,EAAiD;AAEhDiH,IAAAA,mBAAmB,GAAG,oBAAtB;AAEA,GAJD,MAIO,IAAKnE,UAAU,CAACoE,aAAX,KAA6BnH,gBAAlC,EAAqD;AAE3DkH,IAAAA,mBAAmB,GAAG,yBAAtB;AAEA,GAJM,MAIA,IAAKnE,UAAU,CAACoE,aAAX,KAA6BjH,YAAlC,EAAiD;AAEvDgH,IAAAA,mBAAmB,GAAG,oBAAtB;AAEA;;AAED,SAAOA,mBAAP;AAEA;;AAED,SAASE,wBAAT,CAAmCrE,UAAnC,EAAgD;AAE/C,MAAIsE,gBAAgB,GAAG,kBAAvB;;AAEA,MAAKtE,UAAU,CAACe,MAAhB,EAAyB;AAExB,YAASf,UAAU,CAACuE,UAApB;AAEC,WAAKvH,qBAAL;AACA,WAAKL,qBAAL;AACC2H,QAAAA,gBAAgB,GAAG,kBAAnB;AACA;;AAED,WAAKvH,uBAAL;AACA,WAAKD,uBAAL;AACCwH,QAAAA,gBAAgB,GAAG,qBAAnB;AACA;;AAED,WAAKzH,gCAAL;AACA,WAAKH,gCAAL;AACC4H,QAAAA,gBAAgB,GAAG,qBAAnB;AACA;;AAED,WAAK1H,0BAAL;AACC0H,QAAAA,gBAAgB,GAAG,oBAAnB;AACA;AAnBF;AAuBA;;AAED,SAAOA,gBAAP;AAEA;;AAED,SAASE,wBAAT,CAAmCxE,UAAnC,EAAgD;AAE/C,MAAIyE,gBAAgB,GAAG,wBAAvB;;AAEA,MAAKzE,UAAU,CAACe,MAAhB,EAAyB;AAExB,YAASf,UAAU,CAACuE,UAApB;AAEC,WAAK5H,qBAAL;AACA,WAAKD,gCAAL;AACC+H,QAAAA,gBAAgB,GAAG,wBAAnB;AACA;AALF;AASA;;AAED,SAAOA,gBAAP;AAEA;;AAED,SAASC,4BAAT,CAAuC1E,UAAvC,EAAoD;AAEnD,MAAI2E,oBAAoB,GAAG,sBAA3B;;AAEA,MAAK3E,UAAU,CAACe,MAAhB,EAAyB;AAExB,YAASf,UAAU,CAAC4E,OAApB;AAEC,WAAKnI,iBAAL;AACCkI,QAAAA,oBAAoB,GAAG,0BAAvB;AACA;;AAED,WAAKnI,YAAL;AACCmI,QAAAA,oBAAoB,GAAG,qBAAvB;AACA;;AAED,WAAKpI,YAAL;AACCoI,QAAAA,oBAAoB,GAAG,qBAAvB;AACA;AAZF;AAgBA;;AAED,SAAOA,oBAAP;AAEA;;AAED,SAASE,YAAT,CAAuBC,QAAvB,EAAiCC,QAAjC,EAA2C/E,UAA3C,EAAwD;AAEvD,MAAInB,EAAE,GAAGiG,QAAQ,CAACE,UAAT,EAAT;AAEA,MAAI5D,OAAO,GAAGpB,UAAU,CAACoB,OAAzB;AAEA,MAAI6D,YAAY,GAAGjF,UAAU,CAACiF,YAA9B;AACA,MAAIC,cAAc,GAAGlF,UAAU,CAACkF,cAAhC;AACA,MAAIf,mBAAmB,GAAGD,2BAA2B,CAAElE,UAAF,CAArD;AACA,MAAIsE,gBAAgB,GAAGD,wBAAwB,CAAErE,UAAF,CAA/C;AACA,MAAIyE,gBAAgB,GAAGD,wBAAwB,CAAExE,UAAF,CAA/C;AACA,MAAI2E,oBAAoB,GAAGD,4BAA4B,CAAE1E,UAAF,CAAvD;AAGA,MAAImF,iBAAiB,GAAKL,QAAQ,CAACM,WAAT,GAAuB,CAAzB,GAA+BN,QAAQ,CAACM,WAAxC,GAAsD,GAA9E;AAEA,MAAIC,gBAAgB,GAAGrF,UAAU,CAACsF,QAAX,GAAsB,EAAtB,GAA2BvF,kBAAkB,CAAEC,UAAF,CAApE;AAEA,MAAIuF,aAAa,GAAGpE,eAAe,CAAEC,OAAF,CAAnC;AAEA,MAAIK,OAAO,GAAG5C,EAAE,CAAC2G,aAAH,EAAd;AAEA,MAAIC,YAAJ,EAAkBC,cAAlB;;AAEA,MAAK1F,UAAU,CAAC2F,mBAAhB,EAAsC;AAErCF,IAAAA,YAAY,GAAG,CAEdF,aAFc,EAIbtE,MAJa,CAILC,eAJK,EAIa1C,IAJb,CAImB,IAJnB,CAAf;;AAMA,QAAKiH,YAAY,CAAClH,MAAb,GAAsB,CAA3B,EAA+B;AAE9BkH,MAAAA,YAAY,IAAI,IAAhB;AAEA;;AAEDC,IAAAA,cAAc,GAAG,CAEhBL,gBAFgB,EAGhBE,aAHgB,EAKftE,MALe,CAKPC,eALO,EAKW1C,IALX,CAKiB,IALjB,CAAjB;;AAOA,QAAKkH,cAAc,CAACnH,MAAf,GAAwB,CAA7B,EAAiC;AAEhCmH,MAAAA,cAAc,IAAI,IAAlB;AAEA;AAED,GA3BD,MA2BO;AAEND,IAAAA,YAAY,GAAG,CAEd1B,iBAAiB,CAAE/D,UAAF,CAFH,EAId,yBAAyBA,UAAU,CAAC4F,UAJtB,EAMdL,aANc,EAQdvF,UAAU,CAAC6F,UAAX,GAAwB,wBAAxB,GAAmD,EARrC,EASd7F,UAAU,CAAC8F,sBAAX,GAAoC,yBAApC,GAAgE,EATlD,EAWd,0BAA0BX,iBAXZ,EAad,uBAAuBnF,UAAU,CAAC+F,QAbpB,EAcZ/F,UAAU,CAACgG,MAAX,IAAqBhG,UAAU,CAACiG,GAAlC,GAA0C,iBAA1C,GAA8D,EAdhD,EAeZjG,UAAU,CAACgG,MAAX,IAAqBhG,UAAU,CAACkG,OAAlC,GAA8C,kBAA9C,GAAmE,EAfrD,EAiBdlG,UAAU,CAACmG,GAAX,GAAiB,iBAAjB,GAAqC,EAjBvB,EAkBdnG,UAAU,CAACe,MAAX,GAAoB,oBAApB,GAA2C,EAlB7B,EAmBdf,UAAU,CAACe,MAAX,GAAoB,aAAa0D,gBAAjC,GAAoD,EAnBtC,EAoBdzE,UAAU,CAACoG,QAAX,GAAsB,sBAAtB,GAA+C,EApBjC,EAqBdpG,UAAU,CAACqG,KAAX,GAAmB,mBAAnB,GAAyC,EArB3B,EAsBdrG,UAAU,CAACsG,WAAX,GAAyB,yBAAzB,GAAqD,EAtBvC,EAuBdtG,UAAU,CAACI,OAAX,GAAqB,qBAArB,GAA6C,EAvB/B,EAwBdJ,UAAU,CAACuG,SAAX,GAAuB,uBAAvB,GAAiD,EAxBnC,EAyBZvG,UAAU,CAACuG,SAAX,IAAwBvG,UAAU,CAACwG,oBAArC,GAA8D,+BAA9D,GAAgG,EAzBlF,EA0BZxG,UAAU,CAACuG,SAAX,IAAwBvG,UAAU,CAACK,qBAArC,GAA+D,gCAA/D,GAAkG,EA1BpF,EA4BdL,UAAU,CAACyG,YAAX,GAA0B,0BAA1B,GAAuD,EA5BzC,EA6BdzG,UAAU,CAAC0G,qBAAX,GAAmC,oCAAnC,GAA0E,EA7B5D,EA8Bd1G,UAAU,CAACM,kBAAX,GAAgC,iCAAhC,GAAoE,EA9BtD,EA+BdN,UAAU,CAAC2G,eAAX,IAA8B3G,UAAU,CAAC8F,sBAAzC,GAAkE,6BAAlE,GAAkG,EA/BpF,EAgCd9F,UAAU,CAAC4G,WAAX,GAAyB,yBAAzB,GAAqD,EAhCvC,EAiCd5G,UAAU,CAAC6G,YAAX,GAA0B,0BAA1B,GAAuD,EAjCzC,EAkCd7G,UAAU,CAAC8G,YAAX,GAA0B,0BAA1B,GAAuD,EAlCzC,EAmCd9G,UAAU,CAAC+G,QAAX,GAAsB,sBAAtB,GAA+C,EAnCjC,EAqCd/G,UAAU,CAACgH,cAAX,GAA4B,qBAA5B,GAAoD,EArCtC,EAsCdhH,UAAU,CAACiH,YAAX,GAA0B,mBAA1B,GAAgD,EAtClC,EAuCdjH,UAAU,CAACkH,SAAX,GAAuB,gBAAvB,GAA0C,EAvC5B,EAwCdlH,UAAU,CAACmH,aAAX,GAA2B,yBAA3B,GAAuD,EAxCzC,EA0CdnH,UAAU,CAACO,WAAX,GAAyB,qBAAzB,GAAiD,EA1CnC,EA4CdP,UAAU,CAACoH,QAAX,GAAsB,sBAAtB,GAA+C,EA5CjC,EA6CdpH,UAAU,CAACqH,gBAAX,GAA8B,sBAA9B,GAAuD,EA7CzC,EA+CdrH,UAAU,CAACsH,YAAX,GAA0B,0BAA1B,GAAuD,EA/CzC,EAgDdtH,UAAU,CAACuH,YAAX,IAA2BvH,UAAU,CAACO,WAAX,KAA2B,KAAtD,GAA8D,0BAA9D,GAA2F,EAhD7E,EAiDdP,UAAU,CAACwH,WAAX,GAAyB,sBAAzB,GAAkD,EAjDpC,EAkDdxH,UAAU,CAACyH,SAAX,GAAuB,oBAAvB,GAA8C,EAlDhC,EAoDdzH,UAAU,CAAC0H,gBAAX,GAA8B,uBAA9B,GAAwD,EApD1C,EAqDd1H,UAAU,CAAC0H,gBAAX,GAA8B,aAAavD,mBAA3C,GAAiE,EArDnD,EAuDdnE,UAAU,CAAC2H,eAAX,GAA6B,6BAA7B,GAA6D,EAvD/C,EAyDd3H,UAAU,CAACU,sBAAX,GAAoC,yBAApC,GAAgE,EAzDlD,EA0DZV,UAAU,CAACU,sBAAX,IAAqCV,UAAU,CAACW,0BAAlD,GAAiF,6BAAjF,GAAiH,EA1DnG,EA4Dd,2BA5Dc,EA6Dd,+BA7Dc,EA8Dd,gCA9Dc,EA+Dd,0BA/Dc,EAgEd,4BAhEc,EAiEd,8BAjEc,EAkEd,8BAlEc,EAoEd,uBApEc,EAsEd,iCAtEc,EAwEd,QAxEc,EA0Ed,0BA1Ec,EA2Ed,wBA3Ec,EA4Ed,oBA5Ec,EA8Ed,oBA9Ec,EAgFd,0BAhFc,EAkFd,QAlFc,EAoFd,kBApFc,EAsFd,wBAtFc,EAwFd,QAxFc,EA0Fd,yBA1Fc,EA4Fd,+BA5Fc,EA6Fd,+BA7Fc,EA8Fd,+BA9Fc,EA+Fd,+BA/Fc,EAiGd,0BAjGc,EAmGd,gCAnGc,EAoGd,gCApGc,EAqGd,gCArGc,EAsGd,gCAtGc,EAwGd,QAxGc,EA0Gd,gCA1Gc,EA2Gd,gCA3Gc,EA4Gd,gCA5Gc,EA6Gd,gCA7Gc,EA+Gd,SA/Gc,EAiHd,QAjHc,EAmHd,qBAnHc,EAqHd,4BArHc,EAsHd,6BAtHc,EAwHd,QAxHc,EA0Hd,IA1Hc,EA4HbM,MA5Ha,CA4HLC,eA5HK,EA4Ha1C,IA5Hb,CA4HmB,IA5HnB,CAAf;AA8HAkH,IAAAA,cAAc,GAAG,CAEhBL,gBAFgB,EAIhBtB,iBAAiB,CAAE/D,UAAF,CAJD,EAMhB,yBAAyBA,UAAU,CAAC4F,UANpB,EAQhBL,aARgB,EAUhBvF,UAAU,CAAC4H,SAAX,GAAuB,uBAAuB5H,UAAU,CAAC4H,SAAlC,IAAgD5H,UAAU,CAAC4H,SAAX,GAAuB,CAAvB,GAA2B,EAA3B,GAAgC,IAAhF,CAAvB,GAAgH,EAVhG,EAUoG;AAEpH,8BAA0BzC,iBAZV,EAcdnF,UAAU,CAACgG,MAAX,IAAqBhG,UAAU,CAACiG,GAAlC,GAA0C,iBAA1C,GAA8D,EAd9C,EAedjG,UAAU,CAACgG,MAAX,IAAqBhG,UAAU,CAACkG,OAAlC,GAA8C,kBAA9C,GAAmE,EAfnD,EAiBhBlG,UAAU,CAACmG,GAAX,GAAiB,iBAAjB,GAAqC,EAjBrB,EAkBhBnG,UAAU,CAAC6H,MAAX,GAAoB,oBAApB,GAA2C,EAlB3B,EAmBhB7H,UAAU,CAACe,MAAX,GAAoB,oBAApB,GAA2C,EAnB3B,EAoBhBf,UAAU,CAACe,MAAX,GAAoB,aAAauD,gBAAjC,GAAoD,EApBpC,EAqBhBtE,UAAU,CAACe,MAAX,GAAoB,aAAa0D,gBAAjC,GAAoD,EArBpC,EAsBhBzE,UAAU,CAACe,MAAX,GAAoB,aAAa4D,oBAAjC,GAAwD,EAtBxC,EAuBhB3E,UAAU,CAACoG,QAAX,GAAsB,sBAAtB,GAA+C,EAvB/B,EAwBhBpG,UAAU,CAACqG,KAAX,GAAmB,mBAAnB,GAAyC,EAxBzB,EAyBhBrG,UAAU,CAACsG,WAAX,GAAyB,yBAAzB,GAAqD,EAzBrC,EA0BhBtG,UAAU,CAACI,OAAX,GAAqB,qBAArB,GAA6C,EA1B7B,EA2BhBJ,UAAU,CAACuG,SAAX,GAAuB,uBAAvB,GAAiD,EA3BjC,EA4BdvG,UAAU,CAACuG,SAAX,IAAwBvG,UAAU,CAACwG,oBAArC,GAA8D,+BAA9D,GAAgG,EA5BhF,EA6BdxG,UAAU,CAACuG,SAAX,IAAwBvG,UAAU,CAACK,qBAArC,GAA+D,gCAA/D,GAAkG,EA7BlF,EA8BhBL,UAAU,CAACyG,YAAX,GAA0B,0BAA1B,GAAuD,EA9BvC,EA+BhBzG,UAAU,CAAC0G,qBAAX,GAAmC,oCAAnC,GAA0E,EA/B1D,EAgChB1G,UAAU,CAACM,kBAAX,GAAgC,iCAAhC,GAAoE,EAhCpD,EAiChBN,UAAU,CAAC4G,WAAX,GAAyB,yBAAzB,GAAqD,EAjCrC,EAkChB5G,UAAU,CAAC6G,YAAX,GAA0B,0BAA1B,GAAuD,EAlCvC,EAmChB7G,UAAU,CAAC8G,YAAX,GAA0B,0BAA1B,GAAuD,EAnCvC,EAoChB9G,UAAU,CAAC+G,QAAX,GAAsB,sBAAtB,GAA+C,EApC/B,EAsChB/G,UAAU,CAAC8H,KAAX,GAAmB,mBAAnB,GAAyC,EAtCzB,EAwChB9H,UAAU,CAACgH,cAAX,GAA4B,qBAA5B,GAAoD,EAxCpC,EAyChBhH,UAAU,CAACiH,YAAX,GAA0B,mBAA1B,GAAgD,EAzChC,EA0ChBjH,UAAU,CAACkH,SAAX,GAAuB,gBAAvB,GAA0C,EA1C1B,EA2ChBlH,UAAU,CAACmH,aAAX,GAA2B,yBAA3B,GAAuD,EA3CvC,EA6ChBnH,UAAU,CAAC+H,WAAX,GAAyB,yBAAzB,GAAqD,EA7CrC,EA+ChB/H,UAAU,CAACO,WAAX,GAAyB,qBAAzB,GAAiD,EA/CjC,EAiDhBP,UAAU,CAACwH,WAAX,GAAyB,sBAAzB,GAAkD,EAjDlC,EAkDhBxH,UAAU,CAACyH,SAAX,GAAuB,oBAAvB,GAA8C,EAlD9B,EAoDhBzH,UAAU,CAAC0H,gBAAX,GAA8B,uBAA9B,GAAwD,EApDxC,EAqDhB1H,UAAU,CAAC0H,gBAAX,GAA8B,aAAavD,mBAA3C,GAAiE,EArDjD,EAuDhBnE,UAAU,CAACgI,kBAAX,GAAgC,6BAAhC,GAAgE,EAvDhD,EAyDhBhI,UAAU,CAACiI,uBAAX,GAAqC,mCAArC,GAA2E,EAzD3D,EA2DhBjI,UAAU,CAACU,sBAAX,GAAoC,yBAApC,GAAgE,EA3DhD,EA4DdV,UAAU,CAACU,sBAAX,IAAqCV,UAAU,CAACW,0BAAlD,GAAiF,6BAAjF,GAAiH,EA5DjG,EA8Dd,CAAEX,UAAU,CAACc,yBAAX,IAAwCd,UAAU,CAACe,MAArD,KAAiEf,UAAU,CAACgB,iCAA9E,GAAoH,yBAApH,GAAgJ,EA9DhI,EAgEhB,0BAhEgB,EAiEhB,8BAjEgB,EAkEhB,8BAlEgB,EAoEdhB,UAAU,CAACH,WAAX,KAA2BvD,aAA7B,GAA+C,sBAA/C,GAAwE,EApExD,EAqEd0D,UAAU,CAACH,WAAX,KAA2BvD,aAA7B,GAA+CD,WAAW,CAAE,2BAAF,CAA1D,GAA4F,EArE5E,EAqEgF;AAC9F2D,IAAAA,UAAU,CAACH,WAAX,KAA2BvD,aAA7B,GAA+CsD,sBAAsB,CAAE,aAAF,EAAiBI,UAAU,CAACH,WAA5B,CAArE,GAAiH,EAtEjG,EAwEhBG,UAAU,CAACkI,SAAX,GAAuB,mBAAvB,GAA6C,EAxE7B,EA0EdlI,UAAU,CAACmI,cAAX,IAA6BnI,UAAU,CAACoI,WAAxC,IAAuDpI,UAAU,CAACqI,cAAlE,IAAoFrI,UAAU,CAACsI,cAA/F,IAAiHtI,UAAU,CAACuI,mBAA5H,IAAmJvI,UAAU,CAACwI,gBAAhK,GACCnM,WAAW,CAAE,yBAAF,CADZ,GAC4C,EA3E5B,EA2EgC;AAChD2D,IAAAA,UAAU,CAACoI,WAAX,GAAyB5I,wBAAwB,CAAE,kBAAF,EAAsBQ,UAAU,CAACoI,WAAjC,CAAjD,GAAkG,EA5ElF,EA6EhBpI,UAAU,CAACqI,cAAX,GAA4B7I,wBAAwB,CAAE,qBAAF,EAAyBQ,UAAU,CAACqI,cAApC,CAApD,GAA2G,EA7E3F,EA8EhBrI,UAAU,CAACsI,cAAX,GAA4B9I,wBAAwB,CAAE,qBAAF,EAAyBQ,UAAU,CAACsI,cAApC,CAApD,GAA2G,EA9E3F,EA+EhBtI,UAAU,CAACuI,mBAAX,GAAiC/I,wBAAwB,CAAE,0BAAF,EAA8BQ,UAAU,CAACuI,mBAAzC,CAAzD,GAA0H,EA/E1G,EAgFhBvI,UAAU,CAACwI,gBAAX,GAA8BhJ,wBAAwB,CAAE,uBAAF,EAA2BQ,UAAU,CAACwI,gBAAtC,CAAtD,GAAiH,EAhFjG,EAiFhBxI,UAAU,CAACmI,cAAX,GAA4BxI,wBAAwB,CAAE,qBAAF,EAAyBK,UAAU,CAACmI,cAApC,CAApD,GAA2G,EAjF3F,EAmFhBnI,UAAU,CAACyI,YAAX,GAA0B,2BAA2BzI,UAAU,CAACyI,YAAhE,GAA+E,EAnF/D,EAqFhB,IArFgB,EAuFfxH,MAvFe,CAuFPC,eAvFO,EAuFW1C,IAvFX,CAuFiB,IAvFjB,CAAjB;AAyFA;;AAEDyG,EAAAA,YAAY,GAAGlC,eAAe,CAAEkC,YAAF,CAA9B;AACAA,EAAAA,YAAY,GAAGhD,gBAAgB,CAAEgD,YAAF,EAAgBjF,UAAhB,CAA/B;AACAiF,EAAAA,YAAY,GAAGtC,wBAAwB,CAAEsC,YAAF,EAAgBjF,UAAhB,CAAvC;AAEAkF,EAAAA,cAAc,GAAGnC,eAAe,CAAEmC,cAAF,CAAhC;AACAA,EAAAA,cAAc,GAAGjD,gBAAgB,CAAEiD,cAAF,EAAkBlF,UAAlB,CAAjC;AACAkF,EAAAA,cAAc,GAAGvC,wBAAwB,CAAEuC,cAAF,EAAkBlF,UAAlB,CAAzC;AAEAiF,EAAAA,YAAY,GAAG3B,WAAW,CAAE2B,YAAF,CAA1B;AACAC,EAAAA,cAAc,GAAG5B,WAAW,CAAE4B,cAAF,CAA5B;;AAEA,MAAKlF,UAAU,CAACsF,QAAX,IAAuB,CAAEtF,UAAU,CAAC2F,mBAAzC,EAA+D;AAE9D,QAAI+C,qBAAqB,GAAG,KAA5B;AAEA,QAAIC,YAAY,GAAG,8BAAnB;;AAEA,QAAK3I,UAAU,CAAC4I,gBAAX,IACJ3D,YAAY,CAAChC,KAAb,CAAoB0F,YAApB,MAAuC,IADnC,IAEJzD,cAAc,CAACjC,KAAf,CAAsB0F,YAAtB,MAAyC,IAF1C,EAEiD;AAEhDD,MAAAA,qBAAqB,GAAG,IAAxB;AAEAzD,MAAAA,YAAY,GAAGA,YAAY,CAAC/C,OAAb,CAAsByG,YAAtB,EAAoC,EAApC,CAAf;AACAzD,MAAAA,cAAc,GAAGA,cAAc,CAAChD,OAAf,CAAwByG,YAAxB,EAAsC,EAAtC,CAAjB;AAEA,KAf6D,CAiB9D;;;AAEAlD,IAAAA,YAAY,GAAG,CACd,mBADc,EAEd,sBAFc,EAGd,qBAHc,EAId,2BAJc,EAKbjH,IALa,CAKP,IALO,IAKE,IALF,GAKSiH,YALxB;AAOAC,IAAAA,cAAc,GAAG,CAChB,mBADgB,EAEhB,oBAFgB,EAGhBgD,qBAAqB,GAAG,EAAH,GAAQ,8BAHb,EAIhBA,qBAAqB,GAAG,EAAH,GAAQ,mCAJb,EAKhB,sCALgB,EAMhB,2BANgB,EAOhB,6BAPgB,EAQhB,mCARgB,EAShB,oCATgB,EAUhB,4CAVgB,EAWhB,sCAXgB,EAYhB,sCAZgB,EAahB,8CAbgB,EAchB,wCAdgB,EAeflK,IAfe,CAeT,IAfS,IAeA,IAfA,GAeOkH,cAfxB;AAiBA;;AAED,MAAImD,UAAU,GAAGpD,YAAY,GAAGR,YAAhC;AACA,MAAI6D,YAAY,GAAGpD,cAAc,GAAGR,cAApC,CAvUuD,CAyUvD;AACA;;AAEA,MAAI6D,cAAc,GAAG3M,WAAW,CAAEyC,EAAF,EAAMA,EAAE,CAACmK,aAAT,EAAwBH,UAAxB,CAAhC;AACA,MAAII,gBAAgB,GAAG7M,WAAW,CAAEyC,EAAF,EAAMA,EAAE,CAACqK,eAAT,EAA0BJ,YAA1B,CAAlC;AAEAjK,EAAAA,EAAE,CAACsK,YAAH,CAAiB1H,OAAjB,EAA0BsH,cAA1B;AACAlK,EAAAA,EAAE,CAACsK,YAAH,CAAiB1H,OAAjB,EAA0BwH,gBAA1B,EAhVuD,CAkVvD;;AAEA,MAAKjJ,UAAU,CAACoJ,mBAAX,KAAmCjG,SAAxC,EAAoD;AAEnDtE,IAAAA,EAAE,CAACwK,kBAAH,CAAuB5H,OAAvB,EAAgC,CAAhC,EAAmCzB,UAAU,CAACoJ,mBAA9C;AAEA,GAJD,MAIO,IAAKpJ,UAAU,CAACsH,YAAX,KAA4B,IAAjC,EAAwC;AAE9C;AACAzI,IAAAA,EAAE,CAACwK,kBAAH,CAAuB5H,OAAvB,EAAgC,CAAhC,EAAmC,UAAnC;AAEA;;AAED5C,EAAAA,EAAE,CAACyK,WAAH,CAAgB7H,OAAhB,EA/VuD,CAiWvD;;AACA,MAAKqD,QAAQ,CAACyE,KAAT,CAAeC,iBAApB,EAAwC;AAEvC,QAAIC,UAAU,GAAG5K,EAAE,CAAC6K,iBAAH,CAAsBjI,OAAtB,EAAgCpC,IAAhC,EAAjB;AACA,QAAIsK,SAAS,GAAG9K,EAAE,CAACO,gBAAH,CAAqB2J,cAArB,EAAsC1J,IAAtC,EAAhB;AACA,QAAIuK,WAAW,GAAG/K,EAAE,CAACO,gBAAH,CAAqB6J,gBAArB,EAAwC5J,IAAxC,EAAlB;AAEA,QAAIwK,QAAQ,GAAG,IAAf;AACA,QAAIC,eAAe,GAAG,IAAtB;;AAEA,QAAKjL,EAAE,CAAC+C,mBAAH,CAAwBH,OAAxB,EAAiC5C,EAAE,CAACkL,WAApC,MAAsD,KAA3D,EAAmE;AAElEF,MAAAA,QAAQ,GAAG,KAAX;AAEA,UAAIG,YAAY,GAAGpL,eAAe,CAAEC,EAAF,EAAMkK,cAAN,EAAsB,QAAtB,CAAlC;AACA,UAAIkB,cAAc,GAAGrL,eAAe,CAAEC,EAAF,EAAMoK,gBAAN,EAAwB,UAAxB,CAApC;AAEArF,MAAAA,OAAO,CAACsG,KAAR,CAAe,oCAAf,EAAqDrL,EAAE,CAACsL,QAAH,EAArD,EAAoE,oBAApE,EAA0FtL,EAAE,CAAC+C,mBAAH,CAAwBH,OAAxB,EAAiC5C,EAAE,CAACuL,eAApC,CAA1F,EAAiJ,sBAAjJ,EAAyKX,UAAzK,EAAqLO,YAArL,EAAmMC,cAAnM;AAEA,KATD,MASO,IAAKR,UAAU,KAAK,EAApB,EAAyB;AAE/B7F,MAAAA,OAAO,CAACC,IAAR,CAAc,4CAAd,EAA4D4F,UAA5D;AAEA,KAJM,MAIA,IAAKE,SAAS,KAAK,EAAd,IAAoBC,WAAW,KAAK,EAAzC,EAA8C;AAEpDE,MAAAA,eAAe,GAAG,KAAlB;AAEA;;AAED,QAAKA,eAAL,EAAuB;AAEtB,WAAKO,WAAL,GAAmB;AAElBR,QAAAA,QAAQ,EAAEA,QAFQ;AAIlBJ,QAAAA,UAAU,EAAEA,UAJM;AAMlBxE,QAAAA,YAAY,EAAE;AAEb9F,UAAAA,GAAG,EAAEwK,SAFQ;AAGbW,UAAAA,MAAM,EAAE7E;AAHK,SANI;AAalBP,QAAAA,cAAc,EAAE;AAEf/F,UAAAA,GAAG,EAAEyK,WAFU;AAGfU,UAAAA,MAAM,EAAE5E;AAHO;AAbE,OAAnB;AAsBA;AAED,GAxZsD,CA0ZvD;;;AAEA7G,EAAAA,EAAE,CAAC0L,YAAH,CAAiB9I,OAAjB,EAA0BsH,cAA1B;AACAlK,EAAAA,EAAE,CAAC0L,YAAH,CAAiB9I,OAAjB,EAA0BwH,gBAA1B;AAEApK,EAAAA,EAAE,CAAC2L,YAAH,CAAiBzB,cAAjB;AACAlK,EAAAA,EAAE,CAAC2L,YAAH,CAAiBvB,gBAAjB,EAhauD,CAkavD;;AAEA,MAAIwB,cAAJ;;AAEA,OAAKC,WAAL,GAAmB,YAAY;AAE9B,QAAKD,cAAc,KAAKtH,SAAxB,EAAoC;AAEnCsH,MAAAA,cAAc,GAAG,IAAItO,aAAJ,CAAmB0C,EAAnB,EAAuB4C,OAAvB,CAAjB;AAEA;;AAED,WAAOgJ,cAAP;AAEA,GAVD,CAtauD,CAkbvD;;;AAEA,MAAIE,gBAAJ;;AAEA,OAAKC,aAAL,GAAqB,YAAY;AAEhC,QAAKD,gBAAgB,KAAKxH,SAA1B,EAAsC;AAErCwH,MAAAA,gBAAgB,GAAGnJ,uBAAuB,CAAE3C,EAAF,EAAM4C,OAAN,CAA1C;AAEA;;AAED,WAAOkJ,gBAAP;AAEA,GAVD,CAtbuD,CAkcvD;;;AAEA,OAAKE,OAAL,GAAe,YAAY;AAE1BhM,IAAAA,EAAE,CAACiM,aAAH,CAAkBrJ,OAAlB;AACA,SAAKA,OAAL,GAAe0B,SAAf;AAEA,GALD,CApcuD,CA2cvD;;;AAEA,OAAK9B,IAAL,GAAYrB,UAAU,CAAC4F,UAAvB;AACA,OAAKmF,EAAL,GAAU9M,cAAc,EAAxB;AACA,OAAK8G,QAAL,GAAgBA,QAAhB;AACA,OAAKiG,SAAL,GAAiB,CAAjB;AACA,OAAKvJ,OAAL,GAAeA,OAAf;AACA,OAAKwD,YAAL,GAAoB8D,cAApB;AACA,OAAK7D,cAAL,GAAsB+D,gBAAtB;AAEA,SAAO,IAAP;AAEA;;AAED,SAASpE,YAAT","sourcesContent":["/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { WebGLUniforms } from './WebGLUniforms.js';\nimport { WebGLShader } from './WebGLShader.js';\nimport { ShaderChunk } from '../shaders/ShaderChunk.js';\nimport { NoToneMapping, AddOperation, MixOperation, MultiplyOperation, EquirectangularRefractionMapping, CubeRefractionMapping, SphericalReflectionMapping, EquirectangularReflectionMapping, CubeUVRefractionMapping, CubeUVReflectionMapping, CubeReflectionMapping, PCFSoftShadowMap, PCFShadowMap, VSMShadowMap, ACESFilmicToneMapping, CineonToneMapping, Uncharted2ToneMapping, ReinhardToneMapping, LinearToneMapping, GammaEncoding, RGBDEncoding, RGBM16Encoding, RGBM7Encoding, RGBEEncoding, sRGBEncoding, LinearEncoding, LogLuvEncoding } from '../../constants.js';\n\nvar programIdCount = 0;\n\nfunction addLineNumbers( string ) {\n\n\tvar lines = string.split( '\\n' );\n\n\tfor ( var i = 0; i < lines.length; i ++ ) {\n\n\t\tlines[ i ] = ( i + 1 ) + ': ' + lines[ i ];\n\n\t}\n\n\treturn lines.join( '\\n' );\n\n}\n\nfunction getEncodingComponents( encoding ) {\n\n\tswitch ( encoding ) {\n\n\t\tcase LinearEncoding:\n\t\t\treturn [ 'Linear', '( value )' ];\n\t\tcase sRGBEncoding:\n\t\t\treturn [ 'sRGB', '( value )' ];\n\t\tcase RGBEEncoding:\n\t\t\treturn [ 'RGBE', '( value )' ];\n\t\tcase RGBM7Encoding:\n\t\t\treturn [ 'RGBM', '( value, 7.0 )' ];\n\t\tcase RGBM16Encoding:\n\t\t\treturn [ 'RGBM', '( value, 16.0 )' ];\n\t\tcase RGBDEncoding:\n\t\t\treturn [ 'RGBD', '( value, 256.0 )' ];\n\t\tcase GammaEncoding:\n\t\t\treturn [ 'Gamma', '( value, float( GAMMA_FACTOR ) )' ];\n\t\tcase LogLuvEncoding:\n\t\t\treturn [ 'LogLuv', '( value )' ];\n\t\tdefault:\n\t\t\tthrow new Error( 'unsupported encoding: ' + encoding );\n\n\t}\n\n}\n\nfunction getShaderErrors( gl, shader, type ) {\n\n\tvar status = gl.getShaderParameter( shader, gl.COMPILE_STATUS );\n\tvar log = gl.getShaderInfoLog( shader ).trim();\n\n\tif ( status && log === '' ) return '';\n\n\t// --enable-privileged-webgl-extension\n\t// console.log( '**' + type + '**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\n\n\tvar source = gl.getShaderSource( shader );\n\n\treturn 'THREE.WebGLShader: gl.getShaderInfoLog() ' + type + '\\n' + log + addLineNumbers( source );\n\n}\n\nfunction getTexelDecodingFunction( functionName, encoding ) {\n\n\tvar components = getEncodingComponents( encoding );\n\treturn 'vec4 ' + functionName + '( vec4 value ) { return ' + components[ 0 ] + 'ToLinear' + components[ 1 ] + '; }';\n\n}\n\nfunction getTexelEncodingFunction( functionName, encoding ) {\n\n\tvar components = getEncodingComponents( encoding );\n\treturn 'vec4 ' + functionName + '( vec4 value ) { return LinearTo' + components[ 0 ] + components[ 1 ] + '; }';\n\n}\n\nfunction getToneMappingFunction( functionName, toneMapping ) {\n\n\tvar toneMappingName;\n\n\tswitch ( toneMapping ) {\n\n\t\tcase LinearToneMapping:\n\t\t\ttoneMappingName = 'Linear';\n\t\t\tbreak;\n\n\t\tcase ReinhardToneMapping:\n\t\t\ttoneMappingName = 'Reinhard';\n\t\t\tbreak;\n\n\t\tcase Uncharted2ToneMapping:\n\t\t\ttoneMappingName = 'Uncharted2';\n\t\t\tbreak;\n\n\t\tcase CineonToneMapping:\n\t\t\ttoneMappingName = 'OptimizedCineon';\n\t\t\tbreak;\n\n\t\tcase ACESFilmicToneMapping:\n\t\t\ttoneMappingName = 'ACESFilmic';\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'unsupported toneMapping: ' + toneMapping );\n\n\t}\n\n\treturn 'vec3 ' + functionName + '( vec3 color ) { return ' + toneMappingName + 'ToneMapping( color ); }';\n\n}\n\nfunction generateExtensions( parameters ) {\n\n\tvar chunks = [\n\t\t( parameters.extensionDerivatives || parameters.envMapCubeUV || parameters.bumpMap || parameters.tangentSpaceNormalMap || parameters.clearcoatNormalMap || parameters.flatShading || parameters.shaderID === 'physical' ) ? '#extension GL_OES_standard_derivatives : enable' : '',\n\t\t( parameters.extensionFragDepth || parameters.logarithmicDepthBuffer ) && parameters.rendererExtensionFragDepth ? '#extension GL_EXT_frag_depth : enable' : '',\n\t\t( parameters.extensionDrawBuffers && parameters.rendererExtensionDrawBuffers ) ? '#extension GL_EXT_draw_buffers : require' : '',\n\t\t( parameters.extensionShaderTextureLOD || parameters.envMap ) && parameters.rendererExtensionShaderTextureLod ? '#extension GL_EXT_shader_texture_lod : enable' : ''\n\t];\n\n\treturn chunks.filter( filterEmptyLine ).join( '\\n' );\n\n}\n\nfunction generateDefines( defines ) {\n\n\tvar chunks = [];\n\n\tfor ( var name in defines ) {\n\n\t\tvar value = defines[ name ];\n\n\t\tif ( value === false ) continue;\n\n\t\tchunks.push( '#define ' + name + ' ' + value );\n\n\t}\n\n\treturn chunks.join( '\\n' );\n\n}\n\nfunction fetchAttributeLocations( gl, program ) {\n\n\tvar attributes = {};\n\n\tvar n = gl.getProgramParameter( program, gl.ACTIVE_ATTRIBUTES );\n\n\tfor ( var i = 0; i < n; i ++ ) {\n\n\t\tvar info = gl.getActiveAttrib( program, i );\n\t\tvar name = info.name;\n\n\t\t// console.log( 'THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:', name, i );\n\n\t\tattributes[ name ] = gl.getAttribLocation( program, name );\n\n\t}\n\n\treturn attributes;\n\n}\n\nfunction filterEmptyLine( string ) {\n\n\treturn string !== '';\n\n}\n\nfunction replaceLightNums( string, parameters ) {\n\n\treturn string\n\t\t.replace( /NUM_DIR_LIGHTS/g, parameters.numDirLights )\n\t\t.replace( /NUM_SPOT_LIGHTS/g, parameters.numSpotLights )\n\t\t.replace( /NUM_RECT_AREA_LIGHTS/g, parameters.numRectAreaLights )\n\t\t.replace( /NUM_POINT_LIGHTS/g, parameters.numPointLights )\n\t\t.replace( /NUM_HEMI_LIGHTS/g, parameters.numHemiLights )\n\t\t.replace( /NUM_DIR_LIGHT_SHADOWS/g, parameters.numDirLightShadows )\n\t\t.replace( /NUM_SPOT_LIGHT_SHADOWS/g, parameters.numSpotLightShadows )\n\t\t.replace( /NUM_POINT_LIGHT_SHADOWS/g, parameters.numPointLightShadows );\n\n}\n\nfunction replaceClippingPlaneNums( string, parameters ) {\n\n\treturn string\n\t\t.replace( /NUM_CLIPPING_PLANES/g, parameters.numClippingPlanes )\n\t\t.replace( /UNION_CLIPPING_PLANES/g, ( parameters.numClippingPlanes - parameters.numClipIntersection ) );\n\n}\n\n// Resolve Includes\n\nvar includePattern = /^[ \\t]*#include +<([\\w\\d./]+)>/gm;\n\nfunction resolveIncludes( string ) {\n\n\treturn string.replace( includePattern, includeReplacer );\n\n}\n\nfunction includeReplacer( match, include ) {\n\n\tvar string = ShaderChunk[ include ];\n\n\tif ( string === undefined ) {\n\n\t\tthrow new Error( 'Can not resolve #include <' + include + '>' );\n\n\t}\n\n\treturn resolveIncludes( string );\n\n}\n\n// Unroll Loops\n\nvar deprecatedUnrollLoopPattern = /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g;\nvar unrollLoopPattern = /#pragma unroll_loop_start[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}[\\s]+?#pragma unroll_loop_end/g;\n\nfunction unrollLoops( string ) {\n\n\treturn string\n\t\t.replace( unrollLoopPattern, loopReplacer )\n\t\t.replace( deprecatedUnrollLoopPattern, deprecatedLoopReplacer );\n\n}\n\nfunction deprecatedLoopReplacer( match, start, end, snippet ) {\n\n\tconsole.warn( 'WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.' );\n\treturn loopReplacer( match, start, end, snippet );\n\n}\n\nfunction loopReplacer( match, start, end, snippet ) {\n\n\tvar string = '';\n\n\tfor ( var i = parseInt( start ); i < parseInt( end ); i ++ ) {\n\n\t\tstring += snippet\n\t\t\t.replace( /\\[ i \\]/g, '[ ' + i + ' ]' )\n\t\t\t.replace( /UNROLLED_LOOP_INDEX/g, i );\n\n\t}\n\n\treturn string;\n\n}\n\n//\n\nfunction generatePrecision( parameters ) {\n\n\tvar precisionstring = \"precision \" + parameters.precision + \" float;\\nprecision \" + parameters.precision + \" int;\";\n\n\tif ( parameters.precision === \"highp\" ) {\n\n\t\tprecisionstring += \"\\n#define HIGH_PRECISION\";\n\n\t} else if ( parameters.precision === \"mediump\" ) {\n\n\t\tprecisionstring += \"\\n#define MEDIUM_PRECISION\";\n\n\t} else if ( parameters.precision === \"lowp\" ) {\n\n\t\tprecisionstring += \"\\n#define LOW_PRECISION\";\n\n\t}\n\n\treturn precisionstring;\n\n}\n\nfunction generateShadowMapTypeDefine( parameters ) {\n\n\tvar shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\n\n\tif ( parameters.shadowMapType === PCFShadowMap ) {\n\n\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\n\n\t} else if ( parameters.shadowMapType === PCFSoftShadowMap ) {\n\n\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\n\n\t} else if ( parameters.shadowMapType === VSMShadowMap ) {\n\n\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_VSM';\n\n\t}\n\n\treturn shadowMapTypeDefine;\n\n}\n\nfunction generateEnvMapTypeDefine( parameters ) {\n\n\tvar envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\n\n\tif ( parameters.envMap ) {\n\n\t\tswitch ( parameters.envMapMode ) {\n\n\t\t\tcase CubeReflectionMapping:\n\t\t\tcase CubeRefractionMapping:\n\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_CUBE';\n\t\t\t\tbreak;\n\n\t\t\tcase CubeUVReflectionMapping:\n\t\t\tcase CubeUVRefractionMapping:\n\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_CUBE_UV';\n\t\t\t\tbreak;\n\n\t\t\tcase EquirectangularReflectionMapping:\n\t\t\tcase EquirectangularRefractionMapping:\n\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\n\t\t\t\tbreak;\n\n\t\t\tcase SphericalReflectionMapping:\n\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_SPHERE';\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\treturn envMapTypeDefine;\n\n}\n\nfunction generateEnvMapModeDefine( parameters ) {\n\n\tvar envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\n\n\tif ( parameters.envMap ) {\n\n\t\tswitch ( parameters.envMapMode ) {\n\n\t\t\tcase CubeRefractionMapping:\n\t\t\tcase EquirectangularRefractionMapping:\n\t\t\t\tenvMapModeDefine = 'ENVMAP_MODE_REFRACTION';\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\treturn envMapModeDefine;\n\n}\n\nfunction generateEnvMapBlendingDefine( parameters ) {\n\n\tvar envMapBlendingDefine = 'ENVMAP_BLENDING_NONE';\n\n\tif ( parameters.envMap ) {\n\n\t\tswitch ( parameters.combine ) {\n\n\t\t\tcase MultiplyOperation:\n\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\n\t\t\t\tbreak;\n\n\t\t\tcase MixOperation:\n\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\n\t\t\t\tbreak;\n\n\t\t\tcase AddOperation:\n\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\treturn envMapBlendingDefine;\n\n}\n\nfunction WebGLProgram( renderer, cacheKey, parameters ) {\n\n\tvar gl = renderer.getContext();\n\n\tvar defines = parameters.defines;\n\n\tvar vertexShader = parameters.vertexShader;\n\tvar fragmentShader = parameters.fragmentShader;\n\tvar shadowMapTypeDefine = generateShadowMapTypeDefine( parameters );\n\tvar envMapTypeDefine = generateEnvMapTypeDefine( parameters );\n\tvar envMapModeDefine = generateEnvMapModeDefine( parameters );\n\tvar envMapBlendingDefine = generateEnvMapBlendingDefine( parameters );\n\n\n\tvar gammaFactorDefine = ( renderer.gammaFactor > 0 ) ? renderer.gammaFactor : 1.0;\n\n\tvar customExtensions = parameters.isWebGL2 ? '' : generateExtensions( parameters );\n\n\tvar customDefines = generateDefines( defines );\n\n\tvar program = gl.createProgram();\n\n\tvar prefixVertex, prefixFragment;\n\n\tif ( parameters.isRawShaderMaterial ) {\n\n\t\tprefixVertex = [\n\n\t\t\tcustomDefines\n\n\t\t].filter( filterEmptyLine ).join( '\\n' );\n\n\t\tif ( prefixVertex.length > 0 ) {\n\n\t\t\tprefixVertex += '\\n';\n\n\t\t}\n\n\t\tprefixFragment = [\n\n\t\t\tcustomExtensions,\n\t\t\tcustomDefines\n\n\t\t].filter( filterEmptyLine ).join( '\\n' );\n\n\t\tif ( prefixFragment.length > 0 ) {\n\n\t\t\tprefixFragment += '\\n';\n\n\t\t}\n\n\t} else {\n\n\t\tprefixVertex = [\n\n\t\t\tgeneratePrecision( parameters ),\n\n\t\t\t'#define SHADER_NAME ' + parameters.shaderName,\n\n\t\t\tcustomDefines,\n\n\t\t\tparameters.instancing ? '#define USE_INSTANCING' : '',\n\t\t\tparameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '',\n\n\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\n\n\t\t\t'#define MAX_BONES ' + parameters.maxBones,\n\t\t\t( parameters.useFog && parameters.fog ) ? '#define USE_FOG' : '',\n\t\t\t( parameters.useFog && parameters.fogExp2 ) ? '#define FOG_EXP2' : '',\n\n\t\t\tparameters.map ? '#define USE_MAP' : '',\n\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\n\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\n\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\n\t\t\tparameters.aoMap ? '#define USE_AOMAP' : '',\n\t\t\tparameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '',\n\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\n\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\n\t\t\t( parameters.normalMap && parameters.objectSpaceNormalMap ) ? '#define OBJECTSPACE_NORMALMAP' : '',\n\t\t\t( parameters.normalMap && parameters.tangentSpaceNormalMap ) ? '#define TANGENTSPACE_NORMALMAP' : '',\n\n\t\t\tparameters.clearcoatMap ? '#define USE_CLEARCOATMAP' : '',\n\t\t\tparameters.clearcoatRoughnessMap ? '#define USE_CLEARCOAT_ROUGHNESSMAP' : '',\n\t\t\tparameters.clearcoatNormalMap ? '#define USE_CLEARCOAT_NORMALMAP' : '',\n\t\t\tparameters.displacementMap && parameters.supportsVertexTextures ? '#define USE_DISPLACEMENTMAP' : '',\n\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\n\t\t\tparameters.roughnessMap ? '#define USE_ROUGHNESSMAP' : '',\n\t\t\tparameters.metalnessMap ? '#define USE_METALNESSMAP' : '',\n\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\n\n\t\t\tparameters.vertexTangents ? '#define USE_TANGENT' : '',\n\t\t\tparameters.vertexColors ? '#define USE_COLOR' : '',\n\t\t\tparameters.vertexUvs ? '#define USE_UV' : '',\n\t\t\tparameters.uvsVertexOnly ? '#define UVS_VERTEX_ONLY' : '',\n\n\t\t\tparameters.flatShading ? '#define FLAT_SHADED' : '',\n\n\t\t\tparameters.skinning ? '#define USE_SKINNING' : '',\n\t\t\tparameters.useVertexTexture ? '#define BONE_TEXTURE' : '',\n\n\t\t\tparameters.morphTargets ? '#define USE_MORPHTARGETS' : '',\n\t\t\tparameters.morphNormals && parameters.flatShading === false ? '#define USE_MORPHNORMALS' : '',\n\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\n\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\n\n\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\n\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\n\n\t\t\tparameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '',\n\n\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\n\t\t\t( parameters.logarithmicDepthBuffer && parameters.rendererExtensionFragDepth ) ? '#define USE_LOGDEPTHBUF_EXT' : '',\n\n\t\t\t'uniform mat4 modelMatrix;',\n\t\t\t'uniform mat4 modelViewMatrix;',\n\t\t\t'uniform mat4 projectionMatrix;',\n\t\t\t'uniform mat4 viewMatrix;',\n\t\t\t'uniform mat3 normalMatrix;',\n\t\t\t'uniform vec3 cameraPosition;',\n\t\t\t'uniform bool isOrthographic;',\n\n\t\t\t'#ifdef USE_INSTANCING',\n\n\t\t\t' attribute mat4 instanceMatrix;',\n\n\t\t\t'#endif',\n\n\t\t\t'attribute vec3 position;',\n\t\t\t'attribute vec3 normal;',\n\t\t\t'attribute vec2 uv;',\n\n\t\t\t'#ifdef USE_TANGENT',\n\n\t\t\t'\tattribute vec4 tangent;',\n\n\t\t\t'#endif',\n\n\t\t\t'#ifdef USE_COLOR',\n\n\t\t\t'\tattribute vec3 color;',\n\n\t\t\t'#endif',\n\n\t\t\t'#ifdef USE_MORPHTARGETS',\n\n\t\t\t'\tattribute vec3 morphTarget0;',\n\t\t\t'\tattribute vec3 morphTarget1;',\n\t\t\t'\tattribute vec3 morphTarget2;',\n\t\t\t'\tattribute vec3 morphTarget3;',\n\n\t\t\t'\t#ifdef USE_MORPHNORMALS',\n\n\t\t\t'\t\tattribute vec3 morphNormal0;',\n\t\t\t'\t\tattribute vec3 morphNormal1;',\n\t\t\t'\t\tattribute vec3 morphNormal2;',\n\t\t\t'\t\tattribute vec3 morphNormal3;',\n\n\t\t\t'\t#else',\n\n\t\t\t'\t\tattribute vec3 morphTarget4;',\n\t\t\t'\t\tattribute vec3 morphTarget5;',\n\t\t\t'\t\tattribute vec3 morphTarget6;',\n\t\t\t'\t\tattribute vec3 morphTarget7;',\n\n\t\t\t'\t#endif',\n\n\t\t\t'#endif',\n\n\t\t\t'#ifdef USE_SKINNING',\n\n\t\t\t'\tattribute vec4 skinIndex;',\n\t\t\t'\tattribute vec4 skinWeight;',\n\n\t\t\t'#endif',\n\n\t\t\t'\\n'\n\n\t\t].filter( filterEmptyLine ).join( '\\n' );\n\n\t\tprefixFragment = [\n\n\t\t\tcustomExtensions,\n\n\t\t\tgeneratePrecision( parameters ),\n\n\t\t\t'#define SHADER_NAME ' + parameters.shaderName,\n\n\t\t\tcustomDefines,\n\n\t\t\tparameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest + ( parameters.alphaTest % 1 ? '' : '.0' ) : '', // add '.0' if integer\n\n\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\n\n\t\t\t( parameters.useFog && parameters.fog ) ? '#define USE_FOG' : '',\n\t\t\t( parameters.useFog && parameters.fogExp2 ) ? '#define FOG_EXP2' : '',\n\n\t\t\tparameters.map ? '#define USE_MAP' : '',\n\t\t\tparameters.matcap ? '#define USE_MATCAP' : '',\n\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\n\t\t\tparameters.envMap ? '#define ' + envMapTypeDefine : '',\n\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\n\t\t\tparameters.envMap ? '#define ' + envMapBlendingDefine : '',\n\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\n\t\t\tparameters.aoMap ? '#define USE_AOMAP' : '',\n\t\t\tparameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '',\n\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\n\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\n\t\t\t( parameters.normalMap && parameters.objectSpaceNormalMap ) ? '#define OBJECTSPACE_NORMALMAP' : '',\n\t\t\t( parameters.normalMap && parameters.tangentSpaceNormalMap ) ? '#define TANGENTSPACE_NORMALMAP' : '',\n\t\t\tparameters.clearcoatMap ? '#define USE_CLEARCOATMAP' : '',\n\t\t\tparameters.clearcoatRoughnessMap ? '#define USE_CLEARCOAT_ROUGHNESSMAP' : '',\n\t\t\tparameters.clearcoatNormalMap ? '#define USE_CLEARCOAT_NORMALMAP' : '',\n\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\n\t\t\tparameters.roughnessMap ? '#define USE_ROUGHNESSMAP' : '',\n\t\t\tparameters.metalnessMap ? '#define USE_METALNESSMAP' : '',\n\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\n\n\t\t\tparameters.sheen ? '#define USE_SHEEN' : '',\n\n\t\t\tparameters.vertexTangents ? '#define USE_TANGENT' : '',\n\t\t\tparameters.vertexColors ? '#define USE_COLOR' : '',\n\t\t\tparameters.vertexUvs ? '#define USE_UV' : '',\n\t\t\tparameters.uvsVertexOnly ? '#define UVS_VERTEX_ONLY' : '',\n\n\t\t\tparameters.gradientMap ? '#define USE_GRADIENTMAP' : '',\n\n\t\t\tparameters.flatShading ? '#define FLAT_SHADED' : '',\n\n\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\n\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\n\n\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\n\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\n\n\t\t\tparameters.premultipliedAlpha ? '#define PREMULTIPLIED_ALPHA' : '',\n\n\t\t\tparameters.physicallyCorrectLights ? '#define PHYSICALLY_CORRECT_LIGHTS' : '',\n\n\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\n\t\t\t( parameters.logarithmicDepthBuffer && parameters.rendererExtensionFragDepth ) ? '#define USE_LOGDEPTHBUF_EXT' : '',\n\n\t\t\t( ( parameters.extensionShaderTextureLOD || parameters.envMap ) && parameters.rendererExtensionShaderTextureLod ) ? '#define TEXTURE_LOD_EXT' : '',\n\n\t\t\t'uniform mat4 viewMatrix;',\n\t\t\t'uniform vec3 cameraPosition;',\n\t\t\t'uniform bool isOrthographic;',\n\n\t\t\t( parameters.toneMapping !== NoToneMapping ) ? '#define TONE_MAPPING' : '',\n\t\t\t( parameters.toneMapping !== NoToneMapping ) ? ShaderChunk[ 'tonemapping_pars_fragment' ] : '', // this code is required here because it is used by the toneMapping() function defined below\n\t\t\t( parameters.toneMapping !== NoToneMapping ) ? getToneMappingFunction( 'toneMapping', parameters.toneMapping ) : '',\n\n\t\t\tparameters.dithering ? '#define DITHERING' : '',\n\n\t\t\t( parameters.outputEncoding || parameters.mapEncoding || parameters.matcapEncoding || parameters.envMapEncoding || parameters.emissiveMapEncoding || parameters.lightMapEncoding ) ?\n\t\t\t\tShaderChunk[ 'encodings_pars_fragment' ] : '', // this code is required here because it is used by the various encoding/decoding function defined below\n\t\t\tparameters.mapEncoding ? getTexelDecodingFunction( 'mapTexelToLinear', parameters.mapEncoding ) : '',\n\t\t\tparameters.matcapEncoding ? getTexelDecodingFunction( 'matcapTexelToLinear', parameters.matcapEncoding ) : '',\n\t\t\tparameters.envMapEncoding ? getTexelDecodingFunction( 'envMapTexelToLinear', parameters.envMapEncoding ) : '',\n\t\t\tparameters.emissiveMapEncoding ? getTexelDecodingFunction( 'emissiveMapTexelToLinear', parameters.emissiveMapEncoding ) : '',\n\t\t\tparameters.lightMapEncoding ? getTexelDecodingFunction( 'lightMapTexelToLinear', parameters.lightMapEncoding ) : '',\n\t\t\tparameters.outputEncoding ? getTexelEncodingFunction( 'linearToOutputTexel', parameters.outputEncoding ) : '',\n\n\t\t\tparameters.depthPacking ? '#define DEPTH_PACKING ' + parameters.depthPacking : '',\n\n\t\t\t'\\n'\n\n\t\t].filter( filterEmptyLine ).join( '\\n' );\n\n\t}\n\n\tvertexShader = resolveIncludes( vertexShader );\n\tvertexShader = replaceLightNums( vertexShader, parameters );\n\tvertexShader = replaceClippingPlaneNums( vertexShader, parameters );\n\n\tfragmentShader = resolveIncludes( fragmentShader );\n\tfragmentShader = replaceLightNums( fragmentShader, parameters );\n\tfragmentShader = replaceClippingPlaneNums( fragmentShader, parameters );\n\n\tvertexShader = unrollLoops( vertexShader );\n\tfragmentShader = unrollLoops( fragmentShader );\n\n\tif ( parameters.isWebGL2 && ! parameters.isRawShaderMaterial ) {\n\n\t\tvar isGLSL3ShaderMaterial = false;\n\n\t\tvar versionRegex = /^\\s*#version\\s+300\\s+es\\s*\\n/;\n\n\t\tif ( parameters.isShaderMaterial &&\n\t\t\tvertexShader.match( versionRegex ) !== null &&\n\t\t\tfragmentShader.match( versionRegex ) !== null ) {\n\n\t\t\tisGLSL3ShaderMaterial = true;\n\n\t\t\tvertexShader = vertexShader.replace( versionRegex, '' );\n\t\t\tfragmentShader = fragmentShader.replace( versionRegex, '' );\n\n\t\t}\n\n\t\t// GLSL 3.0 conversion\n\n\t\tprefixVertex = [\n\t\t\t'#version 300 es\\n',\n\t\t\t'#define attribute in',\n\t\t\t'#define varying out',\n\t\t\t'#define texture2D texture'\n\t\t].join( '\\n' ) + '\\n' + prefixVertex;\n\n\t\tprefixFragment = [\n\t\t\t'#version 300 es\\n',\n\t\t\t'#define varying in',\n\t\t\tisGLSL3ShaderMaterial ? '' : 'out highp vec4 pc_fragColor;',\n\t\t\tisGLSL3ShaderMaterial ? '' : '#define gl_FragColor pc_fragColor',\n\t\t\t'#define gl_FragDepthEXT gl_FragDepth',\n\t\t\t'#define texture2D texture',\n\t\t\t'#define textureCube texture',\n\t\t\t'#define texture2DProj textureProj',\n\t\t\t'#define texture2DLodEXT textureLod',\n\t\t\t'#define texture2DProjLodEXT textureProjLod',\n\t\t\t'#define textureCubeLodEXT textureLod',\n\t\t\t'#define texture2DGradEXT textureGrad',\n\t\t\t'#define texture2DProjGradEXT textureProjGrad',\n\t\t\t'#define textureCubeGradEXT textureGrad'\n\t\t].join( '\\n' ) + '\\n' + prefixFragment;\n\n\t}\n\n\tvar vertexGlsl = prefixVertex + vertexShader;\n\tvar fragmentGlsl = prefixFragment + fragmentShader;\n\n\t// console.log( '*VERTEX*', vertexGlsl );\n\t// console.log( '*FRAGMENT*', fragmentGlsl );\n\n\tvar glVertexShader = WebGLShader( gl, gl.VERTEX_SHADER, vertexGlsl );\n\tvar glFragmentShader = WebGLShader( gl, gl.FRAGMENT_SHADER, fragmentGlsl );\n\n\tgl.attachShader( program, glVertexShader );\n\tgl.attachShader( program, glFragmentShader );\n\n\t// Force a particular attribute to index 0.\n\n\tif ( parameters.index0AttributeName !== undefined ) {\n\n\t\tgl.bindAttribLocation( program, 0, parameters.index0AttributeName );\n\n\t} else if ( parameters.morphTargets === true ) {\n\n\t\t// programs with morphTargets displace position out of attribute 0\n\t\tgl.bindAttribLocation( program, 0, 'position' );\n\n\t}\n\n\tgl.linkProgram( program );\n\n\t// check for link errors\n\tif ( renderer.debug.checkShaderErrors ) {\n\n\t\tvar programLog = gl.getProgramInfoLog( program ).trim();\n\t\tvar vertexLog = gl.getShaderInfoLog( glVertexShader ).trim();\n\t\tvar fragmentLog = gl.getShaderInfoLog( glFragmentShader ).trim();\n\n\t\tvar runnable = true;\n\t\tvar haveDiagnostics = true;\n\n\t\tif ( gl.getProgramParameter( program, gl.LINK_STATUS ) === false ) {\n\n\t\t\trunnable = false;\n\n\t\t\tvar vertexErrors = getShaderErrors( gl, glVertexShader, 'vertex' );\n\t\t\tvar fragmentErrors = getShaderErrors( gl, glFragmentShader, 'fragment' );\n\n\t\t\tconsole.error( 'THREE.WebGLProgram: shader error: ', gl.getError(), 'gl.VALIDATE_STATUS', gl.getProgramParameter( program, gl.VALIDATE_STATUS ), 'gl.getProgramInfoLog', programLog, vertexErrors, fragmentErrors );\n\n\t\t} else if ( programLog !== '' ) {\n\n\t\t\tconsole.warn( 'THREE.WebGLProgram: gl.getProgramInfoLog()', programLog );\n\n\t\t} else if ( vertexLog === '' || fragmentLog === '' ) {\n\n\t\t\thaveDiagnostics = false;\n\n\t\t}\n\n\t\tif ( haveDiagnostics ) {\n\n\t\t\tthis.diagnostics = {\n\n\t\t\t\trunnable: runnable,\n\n\t\t\t\tprogramLog: programLog,\n\n\t\t\t\tvertexShader: {\n\n\t\t\t\t\tlog: vertexLog,\n\t\t\t\t\tprefix: prefixVertex\n\n\t\t\t\t},\n\n\t\t\t\tfragmentShader: {\n\n\t\t\t\t\tlog: fragmentLog,\n\t\t\t\t\tprefix: prefixFragment\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}\n\n\t}\n\n\t// clean up\n\n\tgl.detachShader( program, glVertexShader );\n\tgl.detachShader( program, glFragmentShader );\n\n\tgl.deleteShader( glVertexShader );\n\tgl.deleteShader( glFragmentShader );\n\n\t// set up caching for uniform locations\n\n\tvar cachedUniforms;\n\n\tthis.getUniforms = function () {\n\n\t\tif ( cachedUniforms === undefined ) {\n\n\t\t\tcachedUniforms = new WebGLUniforms( gl, program );\n\n\t\t}\n\n\t\treturn cachedUniforms;\n\n\t};\n\n\t// set up caching for attribute locations\n\n\tvar cachedAttributes;\n\n\tthis.getAttributes = function () {\n\n\t\tif ( cachedAttributes === undefined ) {\n\n\t\t\tcachedAttributes = fetchAttributeLocations( gl, program );\n\n\t\t}\n\n\t\treturn cachedAttributes;\n\n\t};\n\n\t// free resource\n\n\tthis.destroy = function () {\n\n\t\tgl.deleteProgram( program );\n\t\tthis.program = undefined;\n\n\t};\n\n\t//\n\n\tthis.name = parameters.shaderName;\n\tthis.id = programIdCount ++;\n\tthis.cacheKey = cacheKey;\n\tthis.usedTimes = 1;\n\tthis.program = program;\n\tthis.vertexShader = glVertexShader;\n\tthis.fragmentShader = glFragmentShader;\n\n\treturn this;\n\n}\n\nexport { WebGLProgram };\n"]},"metadata":{},"sourceType":"module"}